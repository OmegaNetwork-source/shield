// STRIX Native Pentest Framework
// Type definitions for our scanning/exploit system

export interface ScanTarget {
    host: string;
    ports?: number[];
    portRange?: { start: number; end: number };
}

export interface PortResult {
    port: number;
    state: 'open' | 'closed' | 'filtered';
    service?: string;
    banner?: string;
    version?: string;
}

export interface HostResult {
    host: string;
    ip: string;
    hostname?: string;
    os?: string;
    ports: PortResult[];
    vulnerabilities: VulnerabilityResult[];
    scanTime: Date;
}

export interface VulnerabilityResult {
    id: string;
    name: string;
    severity: 'critical' | 'high' | 'medium' | 'low' | 'info';
    description: string;
    evidence?: string;
    remediation?: string;
    cve?: string;
    cvss?: number;
    host: string;
    port?: number;
    service?: string;
}

export interface ModuleOption {
    name: string;
    type: 'string' | 'number' | 'boolean' | 'select';
    required: boolean;
    default?: any;
    description: string;
    choices?: string[];
}

export interface ModuleInfo {
    name: string;
    displayName: string;
    description: string;
    author: string;
    version: string;
    type: 'scanner' | 'vuln_check' | 'exploit' | 'auxiliary';
    targetService?: string;
    options: ModuleOption[];
}

export interface ModuleResult {
    success: boolean;
    module: string;
    target: string;
    data: any;
    vulnerabilities?: VulnerabilityResult[];
    error?: string;
    duration: number;
}

export interface ScanProgress {
    phase: string;
    current: number;
    total: number;
    message: string;
}

export type ProgressCallback = (progress: ScanProgress) => void;

// Common port lists
export const COMMON_PORTS = {
    top20: [21, 22, 23, 25, 53, 80, 110, 111, 135, 139, 143, 443, 445, 993, 995, 1723, 3306, 3389, 5900, 8080],
    top100: [
        7, 9, 13, 21, 22, 23, 25, 26, 37, 53, 79, 80, 81, 88, 106, 110, 111, 113, 119, 135,
        139, 143, 144, 179, 199, 389, 427, 443, 444, 445, 465, 513, 514, 515, 543, 544, 548,
        554, 587, 631, 646, 873, 990, 993, 995, 1025, 1026, 1027, 1028, 1029, 1110, 1433, 1720,
        1723, 1755, 1900, 2000, 2001, 2049, 2121, 2717, 3000, 3128, 3306, 3389, 3986, 4899, 5000,
        5009, 5051, 5060, 5101, 5190, 5357, 5432, 5631, 5666, 5800, 5900, 6000, 6001, 6646, 7070,
        8000, 8008, 8009, 8080, 8081, 8443, 8888, 9100, 9999, 10000, 32768, 49152, 49153, 49154
    ],
    web: [80, 443, 8080, 8443, 8000, 8008, 8888, 9000, 9090, 9443],
    database: [1433, 1521, 3306, 5432, 6379, 27017, 5984, 9200],
    remote: [22, 23, 3389, 5900, 5901, 5902],
    mail: [25, 110, 143, 465, 587, 993, 995],
    file: [21, 69, 111, 137, 138, 139, 445, 873, 2049]
};

// Service signatures for banner detection
export const SERVICE_SIGNATURES: { [key: string]: RegExp[] } = {
    'ssh': [/^SSH-/i, /OpenSSH/i, /Dropbear/i],
    'ftp': [/^220.*FTP/i, /vsftpd/i, /ProFTPD/i, /Pure-FTPd/i, /FileZilla/i],
    'http': [/^HTTP\/\d/i, /Apache/i, /nginx/i, /IIS/i, /Server:/i],
    'smtp': [/^220.*SMTP/i, /^220.*mail/i, /Postfix/i, /Sendmail/i, /Exchange/i],
    'pop3': [/^\+OK.*POP3/i, /^\+OK.*Dovecot/i],
    'imap': [/^\* OK.*IMAP/i, /Dovecot/i],
    'mysql': [/mysql/i, /MariaDB/i],
    'mssql': [/Microsoft SQL Server/i, /MSSQL/i],
    'postgresql': [/PostgreSQL/i],
    'redis': [/^-ERR.*redis/i, /REDIS/i],
    'mongodb': [/MongoDB/i],
    'smb': [/SMB/i, /Samba/i, /Windows/i],
    'rdp': [/RDP/i, /Remote Desktop/i],
    'telnet': [/telnet/i, /login:/i],
    'dns': [/BIND/i, /named/i],
    'ldap': [/LDAP/i, /Active Directory/i],
    'vnc': [/RFB/i, /VNC/i]
};

// Port to likely service mapping
export const PORT_SERVICE_MAP: { [key: number]: string } = {
    21: 'ftp',
    22: 'ssh',
    23: 'telnet',
    25: 'smtp',
    53: 'dns',
    80: 'http',
    110: 'pop3',
    111: 'rpc',
    135: 'msrpc',
    137: 'netbios-ns',
    138: 'netbios-dgm',
    139: 'netbios-ssn',
    143: 'imap',
    443: 'https',
    445: 'smb',
    465: 'smtps',
    587: 'submission',
    993: 'imaps',
    995: 'pop3s',
    1433: 'mssql',
    1521: 'oracle',
    3306: 'mysql',
    3389: 'rdp',
    5432: 'postgresql',
    5900: 'vnc',
    6379: 'redis',
    8080: 'http-proxy',
    8443: 'https-alt',
    27017: 'mongodb'
};
